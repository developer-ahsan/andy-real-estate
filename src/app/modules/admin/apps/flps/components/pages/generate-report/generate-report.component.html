<div class="w-full lg:p-12 md:p-8 px-6" *ngIf="!isGenerateReport">

    <!-- Form -->

    <!-- Section -->
    <div class="w-full">
        <mat-form-field class="w-full">
            <mat-label>Select an employee</mat-label>
            <input matInput placeholder="Search Employee Name" [matAutocomplete]="auto"
                [formControl]="searcEmployeeCtrl" placeholder="Min 3 Characters">
            <mat-autocomplete class="w-full" #auto="matAutocomplete" (optionSelected)="onSelected($event)"
                [displayWith]="displayWith">
                <mat-option *ngIf="isSearching" class="is-loading">Loading...</mat-option>
                <ng-container *ngIf="!isSearching">
                    <mat-option *ngFor="let item of employeeAdmins" [value]="item">
                        <span>{{item.firstName +' ' + item.lastName}}</span>
                    </mat-option>
                </ng-container>
            </mat-autocomplete>
        </mat-form-field>
        <mat-form-field class="w-full">
            <mat-label>Report Type</mat-label>
            <mat-select matInput [(ngModel)]="ngReportType">
                <mat-option [value]="1">Orders pending FLPS payment</mat-option>
                <mat-option [value]="2">Orders marked FLPS paid</mat-option>
            </mat-select>
        </mat-form-field>
    </div>
    <div class="grid sm:grid-cols-2 gap-4 w-full mt-8">
        <mat-radio-group class="invisible absolute w-0 h-0 pointer-events-none" [(ngModel)]="ngPlan"
            #planRadioGroup="matRadioGroup">
            <ng-container *ngFor="let plan of plans; trackBy: trackByFn">
                <mat-radio-button [value]="plan.value"></mat-radio-button>
            </ng-container>
        </mat-radio-group>
        <ng-container *ngFor="let plan of plans; trackBy: trackByFn">
            <div class="relative flex flex-col items-start justify-start p-6 rounded-md shadow cursor-pointer bg-card"
                [ngClass]="{'ring ring-inset ring-primary': ngPlan === plan.value}" (click)="ngPlan = plan.value">
                <ng-container *ngIf="ngPlan === plan.value">
                    <mat-icon class="absolute top-0 right-0 mt-3 mr-3 icon-size-7 text-primary"
                        [svgIcon]="'heroicons_solid:check-circle'"></mat-icon>
                </ng-container>
                <div class="font-medium">{{plan.label}}</div>
                <div class="mt-1 whitespace-normal text-secondary">{{plan.details}}</div>
                <div class="flex-auto"></div>
                <div *ngIf="plan.value == 'weekly'" class="w-full mt-2">
                    <mat-form-field appearance="fill" class="w-full">
                        <input matInput [matDatepicker]="picker" (click)="picker.open()" readonly [max]="maxDate"
                            [(ngModel)]="WeekDate">
                        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                        <mat-datepicker #picker></mat-datepicker>
                    </mat-form-field>
                </div>
                <div *ngIf="plan.value == 'monthly'" class="w-full mt-2 flex">
                    <mat-form-field class="w-50 mr-2">
                        <mat-select [(ngModel)]="monthlyMonth">
                            <mat-option *ngFor="let item of months" [value]="item">{{item}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                    <mat-form-field class="w-50">
                        <mat-select [(ngModel)]="monthlyYear">
                            <mat-option *ngFor="let item of years" [value]="item">{{item}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div *ngIf="plan.value == 'quarterly'" class="w-full mt-2 flex">
                    <mat-form-field class="w-50 mr-2">
                        <mat-select [(ngModel)]="quarterMonth">
                            <mat-option *ngFor="let item of quarterly" [value]="item.value">{{item.text}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                    <mat-form-field class="w-50">
                        <mat-select [(ngModel)]="quarterYear">
                            <mat-option *ngFor="let item of years" [value]="item">{{item}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div *ngIf="plan.value == 'yearly'" class="w-full mt-2 flex">
                    <mat-form-field class="w-full ">
                        <mat-select [(ngModel)]="yearlyYear">
                            <mat-option *ngFor="let item of years" [value]="item">{{item}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div *ngIf="plan.value == 'range'" class="w-full mt-2 flex">
                    <mat-form-field class="w-full">
                        <mat-date-range-input [rangePicker]="picker1" (click)="picker1.open()" [max]="maxDate">
                            <input matStartDate placeholder="Start date" readonly [(ngModel)]="ngRangeStart">
                            <input matEndDate placeholder="End date" readonly [(ngModel)]="ngRangeEnd">
                        </mat-date-range-input>
                        <mat-datepicker-toggle matIconSuffix [for]="picker1"></mat-datepicker-toggle>
                        <mat-date-range-picker #picker1></mat-date-range-picker>
                    </mat-form-field>
                </div>
                <!-- <div class="mt-8 text-lg">
                    <span>{{plan.price | currency:'USD':'symbol':'1.0'}}</span>
                    <span class="text-secondary"> / month</span>
                </div> -->
            </div>
        </ng-container>
    </div>

    <!-- Divider -->
    <div class="mt-5 mb-5 border-t"></div>

    <!-- Actions -->
    <div class="flex items-center justify-end">
        <button class="ml-4 min-w-60" mat-flat-button type="button" [color]="'primary'" (click)="generateReport()"
            [disabled]="generateReportLoader">
            <span *ngIf="!generateReportLoader">Generate Report</span>
            <mat-progress-spinner *ngIf="generateReportLoader" [diameter]="24" [mode]="'indeterminate'">
            </mat-progress-spinner>
        </button>
    </div>

</div>
<div class="w-full" *ngIf="isGenerateReport">
    <div class="w-full bg-card p-5">
        <div class="flex justify-between mb-1">
            <p class="text-xl font-semibold">{{selectedEmployee.firstName + ' ' + selectedEmployee.lastName}} - <span
                    class="text-secondary">{{report_type}}</span></p>
            <button matTooltip="Back to filters" class="min-w-30" mat-stroked-button
                (click)="backToFilters()">Back</button>
        </div>

        <fuse-alert [appearance]="'soft'" [type]="'warning'" [showIcon]="false">
            Programs with royalty passthrough amounts are reflecting the actual profit margins on the orders without
            royalties
        </fuse-alert>
    </div>
    <div *ngIf="dataSource.length > 0;else other_content" class="w-full">
        <table mat-table [dataSource]="dataSource" class="w-full border-t">
            <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef class="w-15 min-w-15">
                    Date
                </th>
                <td mat-cell *matCellDef="let element">
                    {{element.orderDate | date}}
                </td>
            </ng-container>
            <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef class="w-15 min-w-15">
                    ID
                </th>
                <td mat-cell *matCellDef="let element">
                    {{element.pk_orderID}}
                </td>
            </ng-container>
            <ng-container matColumnDef="store_name">
                <th mat-header-cell *matHeaderCellDef class="w-30 min-w-30 ">
                    Store Name
                </th>
                <td mat-cell *matCellDef="let element">
                    {{element.storeName}}
                </td>
            </ng-container>
            <ng-container matColumnDef="payment">
                <th mat-header-cell *matHeaderCellDef class="w-15 min-w-15 text-center">
                    Amount Paid
                </th>
                <td mat-cell *matCellDef="let element" class="text-center">
                    {{element.paymentDate ? element.price : 0.0 | currency}}
                </td>
            </ng-container>
            <ng-container matColumnDef="action">
                <th mat-header-cell *matHeaderCellDef class="w-15 min-w-15 text-center">
                    Action
                </th>
                <td mat-cell *matCellDef="let element" class="text-center">
                    <mat-checkbox></mat-checkbox>
                </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns;" class="h-18 bg-light"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"
                class="h-14 hover:bg-gray-100 dark:hover:bg-hover" style="cursor: pointer;">
            </tr>
        </table>
        <mat-paginator #paginator class="border-b sm:border-t sm:border-b-0 z-10 bg-gray-50 dark:bg-transparent"
            [ngClass]="{'pointer-events-none': isLoading}" [length]="totalUsers" [pageIndex]="0" [pageSize]="20"
            (page)="getNextData($event)" [hidePageSize]="true">
        </mat-paginator>
    </div>
    <!-- No color Found -->
    <ng-template #other_content>
        <div class="text-secondary font-semibold p-5 text-center">
            There are currently no Orders.
        </div>
    </ng-template>
</div>