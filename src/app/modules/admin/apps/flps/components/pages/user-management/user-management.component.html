<div class="w-full">
    <div class="alert m-4 w-full alert-danger p-4 text-lg text-center font-bold"
        *ngIf="!_flpsService.flpsPermissions.selectFLPSUser">
        You do not have permission to access this section.
    </div>
    <div class="w-full" *ngIf="_flpsService.flpsPermissions.selectFLPSUser">
        <div class="shadow bg-card p-5 px-8 flex space-x-6" *ngIf="!isUpdateUser">
            <span class="font-medium cursor-pointer hover:text-gray-900 text-secondary"
                [ngClass]="{'text-gray-900': mainScreen=='Current Users'}"
                (click)="calledScreen('Current Users')">Current Users</span>
            <span class="font-medium cursor-pointer hover:text-gray-900 text-secondary"
                [ngClass]="{'text-gray-900': mainScreen=='New FLPS User'}" (click)="calledScreen('New FLPS User')">New
                FLPS User</span>
            <span class="font-medium cursor-pointer hover:text-gray-900 text-secondary"
                [ngClass]="{'text-gray-900': mainScreen=='View Disabled Users'}"
                (click)="calledScreen('View Disabled Users')">View Disabled Users</span>
        </div>
        <!-- <div class="px-2 pb-2" *ngIf="!isUpdateUser">
            <mat-button-toggle-group #group="matButtonToggleGroup" [value]="mainScreen"
                (change)="calledScreen(group.value)">
                <mat-button-toggle value="Current Users">
                    Current Users
                </mat-button-toggle>
                <mat-button-toggle value="New FLPS User">
                    New FLPS User
                </mat-button-toggle>
                <mat-button-toggle value="View Disabled Users">
                    View Disabled Users
                </mat-button-toggle>
            </mat-button-toggle-group>
        </div> -->
        <div class="p-5" *ngIf="mainScreen == 'Current Users' && isLoading">
            <ngx-skeleton-loader count="8" appearance="line" animation="pulse" [theme]="{ 
                'background-color': '#dedede'
              }">
            </ngx-skeleton-loader>
        </div>

        <div class="mt-5" *ngIf="mainScreen == 'Current Users' && !isLoading && !isUpdateUser">
            <div *ngIf="dataSource.length > 0;else other_content" class="w-full">
                <table mat-table [dataSource]="dataSource" class="w-full border-t">
                    <ng-container matColumnDef="id">
                        <th mat-header-cell *matHeaderCellDef class="w-15 min-w-15">
                            ID
                        </th>
                        <td (click)="toggleUpdateUserData(element, true)" mat-cell *matCellDef="let element">
                            {{element.pk_userID || not_available}}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="f_name">
                        <th mat-header-cell *matHeaderCellDef class="w-30 min-w-30">
                            First Name
                        </th>
                        <td (click)="toggleUpdateUserData(element, true)" mat-cell *matCellDef="let element">
                            {{element.firstName}}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="l_name">
                        <th mat-header-cell *matHeaderCellDef class="w-30 min-w-30 ">
                            Last Name
                        </th>
                        <td (click)="toggleUpdateUserData(element, true)" mat-cell *matCellDef="let element">
                            {{element.lastName}}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="admin">
                        <th mat-header-cell *matHeaderCellDef class="w-15 min-w-15 text-center">
                            Admin
                        </th>
                        <td (click)="toggleUpdateUserData(element, true)" mat-cell *matCellDef="let element"
                            class="text-center">
                            <div class="flex justify-center">
                                <mat-icon class="text-green-900" svgIcon="heroicons_outline:check"
                                    *ngIf="element.blnAdmin"></mat-icon>
                                <mat-icon class="text-red-900" svgIcon="heroicons_outline:x"
                                    *ngIf="!element.blnAdmin"></mat-icon>
                            </div>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="action">
                        <th mat-header-cell *matHeaderCellDef class="w-15 min-w-15 text-center">
                            Action
                        </th>
                        <td mat-cell *matCellDef="let element" class="text-center">
                            <div class="flex justify-center">
                                <mat-icon (click)="toggleUpdateUserData(element, true)"
                                    svgIcon="heroicons_outline:pencil-alt"></mat-icon>
                                <!-- <mat-icon (click)="deleteUser(element,1)" svgIcon="heroicons_outline:trash"
                                    *ngIf="!element.delLoader"></mat-icon>
                                <mat-progress-spinner *ngIf="element.delLoader" [diameter]="24"
                                    [mode]="'indeterminate'">
                                </mat-progress-spinner> -->
                            </div>
                        </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="displayedColumns;" class="h-18 bg-light"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"
                        class="h-14 hover:bg-gray-100 dark:hover:bg-hover" style="cursor: pointer;">
                    </tr>
                </table>
                <mat-paginator #paginator class="border-b sm:border-t sm:border-b-0 z-10 bg-gray-50 dark:bg-transparent"
                    [ngClass]="{'pointer-events-none': isLoading}" [length]="totalUsers"
                    [pageIndex]="this.flpPages.page-1" [pageSize]="20" (page)="getNextData($event)"
                    [hidePageSize]="true">
                </mat-paginator>
            </div>
            <!-- No color Found -->
            <ng-template #other_content>
                <div class="text-secondary font-semibold p-5 text-center">
                    There are currently no FLPS users.
                </div>
            </ng-template>
        </div>
        <div *ngIf="mainScreen == 'New FLPS User' && !isUpdateUser" class="mt-5">
            <div class="shadow bg-card p-6">
                <div class="row" [formGroup]="addNewUserForm">
                    <div class="col-12 col-md-6">
                        <mat-form-field class="w-full">
                            <mat-label>Employee* </mat-label>
                            <mat-select matInput formControlName="admin_user_id">
                                <mat-option [value]="0">Select an employee</mat-option>
                                <mat-option *ngFor="let item of employeeUser" [value]="item.pk_userID">{{item.firstName
                                    + '
                                    ' + item.lastName}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="col-12 col-md-6">
                        <mat-form-field class="w-full">
                            <mat-label>First Name (30)* </mat-label>
                            <input matInput type="text" maxlength="30" formControlName="firstName">
                        </mat-form-field>
                    </div>
                    <div class="col-12 col-md-6">
                        <mat-form-field class="w-full">
                            <mat-label>Last Name (50)* </mat-label>
                            <input matInput type="text" maxlength="50" formControlName="lastName">
                        </mat-form-field>
                    </div>
                    <div class="col-12 col-md-6">
                        <mat-form-field class="w-full">
                            <mat-label>Email (50)* </mat-label>
                            <input matInput type="text" maxlength="50" formControlName="email">
                        </mat-form-field>
                    </div>
                    <div class="col-12 col-md-6">
                        <mat-form-field class="w-full">
                            <mat-label>UserName (15)* </mat-label>
                            <input matInput type="text" maxlength="15" formControlName="userName">
                        </mat-form-field>
                    </div>
                    <div class="col-12 col-md-6">
                        <mat-form-field class="w-full">
                            <mat-label>Password(15)* </mat-label>
                            <input matInput type="text" maxlength="15" formControlName="password">
                        </mat-form-field>
                    </div>
                    <div class="col-12 col-md-6">
                        <mat-form-field class="w-full">
                            <mat-label>Default Commission (%)* </mat-label>
                            <input matInput (keyup)="_commonService.validateInput($event)" type="number"
                                formControlName="defaultCommission">
                        </mat-form-field>
                    </div>
                    <div class="col-12 col-md-6">
                        <mat-form-field class="w-full">
                            <mat-label>Admin User</mat-label>
                            <mat-select matInput formControlName="blnAdmin">
                                <mat-option [value]="false">No</mat-option>
                                <mat-option [value]="true">Yes</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>

                    <div class="text-right col-12">
                        <button [disabled]="isAddNewUserLoader || !addNewUserForm.valid" class="min-w-50"
                            mat-stroked-button [matTooltip]="'Add New User'" (click)="addNewUser()">
                            <mat-icon svgIcon="heroicons_solid:plus" *ngIf="!isAddNewUserLoader"></mat-icon>
                            <span class="ml-2" *ngIf="!isAddNewUserLoader"> Add New User </span>
                            <mat-progress-spinner *ngIf="isAddNewUserLoader" [diameter]="24" [mode]="'indeterminate'">
                            </mat-progress-spinner>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="mt-5" *ngIf="mainScreen == 'View Disabled Users' && !isUpdateUser">
            <div class="px-5" *ngIf="isDisabledLoading">
                <ngx-skeleton-loader count="8" appearance="line" animation="pulse" [theme]="{ 
                    'background-color': '#dedede'
                  }">
                </ngx-skeleton-loader>
            </div>
            <div *ngIf="disabledDataSource.length > 0 && !isDisabledLoading;else other_content" class="w-full">
                <table mat-table [dataSource]="disabledDataSource" class="w-full border-t">
                    <ng-container matColumnDef="id">
                        <th mat-header-cell *matHeaderCellDef class="w-15 min-w-15">
                            ID
                        </th>
                        <td mat-cell *matCellDef="let element">
                            {{element.pk_userID || not_available}}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="f_name">
                        <th mat-header-cell *matHeaderCellDef class="w-30 min-w-30">
                            First Name
                        </th>
                        <td mat-cell *matCellDef="let element">
                            {{element.firstName}}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="l_name">
                        <th mat-header-cell *matHeaderCellDef class="w-30 min-w-30 ">
                            Last Name
                        </th>
                        <td mat-cell *matCellDef="let element">
                            {{element.lastName}}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="admin">
                        <th mat-header-cell *matHeaderCellDef class="w-15 min-w-15 text-center">
                            Admin
                        </th>
                        <td mat-cell *matCellDef="let element" class="text-center">
                            <div class="flex justify-center">
                                <mat-icon class="text-green-900" svgIcon="heroicons_outline:check"
                                    *ngIf="element.blnAdmin"></mat-icon>
                                <mat-icon class="text-red-900" svgIcon="heroicons_outline:x"
                                    *ngIf="!element.blnAdmin"></mat-icon>
                            </div>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="action">
                        <th mat-header-cell *matHeaderCellDef class="w-15 min-w-15 text-center">
                            Action
                        </th>
                        <td mat-cell *matCellDef="let element" class="text-center">
                            <div class="flex justify-center">
                                <mat-icon (click)="toggleUpdateUserData(element, true)"
                                    svgIcon="heroicons_outline:pencil-alt"></mat-icon>
                                <mat-icon (click)="deleteUser(element,0)" svgIcon="heroicons_outline:trash"
                                    *ngIf="!element.delLoader"></mat-icon>
                                <mat-progress-spinner *ngIf="element.delLoader" [diameter]="24"
                                    [mode]="'indeterminate'">
                                </mat-progress-spinner>
                            </div>
                        </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="displayedColumns;" class="h-18 bg-light"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"
                        class="h-14 hover:bg-gray-100 dark:hover:bg-hover" style="cursor: pointer;">
                    </tr>
                </table>
                <mat-paginator #paginator class="border-b sm:border-t sm:border-b-0 z-10 bg-gray-50 dark:bg-transparent"
                    [ngClass]="{'pointer-events-none': isDisabledLoading}" [length]="distabledTotalUsers"
                    [pageIndex]="0" [pageSize]="20" (page)="getNextDisabledData($event)" [hidePageSize]="true">
                </mat-paginator>
            </div>
            <ng-template #other_content>
                <div class="text-secondary font-semibold p-5 text-center" *ngIf="!isDisabledLoading">
                    There are currently no FLPS users.
                </div>
            </ng-template>
        </div>
        <!-- Update Method -->
        <div *ngIf="isUpdateUser">
            <div class="shadow bg-card p-5 px-8 flex space-x-6 overflow-x-auto">
                <span class="font-medium cursor-pointer hover:text-gray-900 text-primary"
                    (click)="toggleUpdateUserData(null, false)" matTooltip="View Users List">Users</span>
                <span class="font-medium cursor-pointer hover:text-gray-900 text-secondary"
                    [ngClass]="{'text-gray-900': mainScreenUser=='Edit User'}"
                    (click)="calledUserScreen('Edit User')">Edit User</span>
                <span class="font-medium cursor-pointer hover:text-gray-900 text-secondary"
                    [ngClass]="{'text-gray-900': mainScreenUser=='View Orders'}"
                    (click)="calledUserScreen('View Orders')">View Orders</span>
                <span class="font-medium cursor-pointer hover:text-gray-900 text-secondary"
                    [ngClass]="{'text-gray-900': mainScreenUser=='View Customers'}"
                    (click)="calledUserScreen('View Customers')">View Customers</span>
                <span class="font-medium cursor-pointer hover:text-gray-900 text-secondary"
                    [ngClass]="{'text-gray-900': mainScreenUser=='Blanket Customer Percentage'}"
                    (click)="calledUserScreen('Blanket Customer Percentage')">Blanket Customer Percentage</span>
                <span class="font-medium cursor-pointer hover:text-gray-900 text-secondary"
                    [ngClass]="{'text-gray-900': mainScreenUser=='Remove User'}"
                    (click)="calledUserScreen('Remove User')">Remove User</span>
            </div>

            <!-- Edit User -->
            <div class="mt-5" *ngIf="mainScreenUser == 'Edit User'">
                <div class="shadow bg-card p-6">
                    <div class="row" [formGroup]="updateUserForm">
                        <div class="col-12 pb-5">
                            <h2 class="text-lg font-semibold">Edit User</h2>
                        </div>
                        <div class="col-12 col-md-6">
                            <mat-form-field class="w-full">
                                <mat-label>Employee* </mat-label>
                                <mat-select matInput formControlName="fk_adminUserID">
                                    <mat-option [value]="0">Select an employee</mat-option>
                                    <mat-option *ngFor="let item of employeeUser"
                                        [value]="item.pk_userID">{{item.firstName
                                        + '
                                        ' + item.lastName}}</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <div class="col-12 col-md-6">
                            <mat-form-field class="w-full">
                                <mat-label>First Name (30)* </mat-label>
                                <input matInput type="text" maxlength="30" formControlName="firstName">
                            </mat-form-field>
                        </div>
                        <div class="col-12 col-md-6">
                            <mat-form-field class="w-full">
                                <mat-label>Last Name (50)* </mat-label>
                                <input matInput type="text" maxlength="50" formControlName="lastName">
                            </mat-form-field>
                        </div>
                        <div class="col-12 col-md-6">
                            <mat-form-field class="w-full">
                                <mat-label>Email (50)* </mat-label>
                                <input matInput type="text" maxlength="50" formControlName="email">
                            </mat-form-field>
                        </div>
                        <div class="col-12 col-md-6">
                            <mat-form-field class="w-full">
                                <mat-label>UserName (15)* </mat-label>
                                <input matInput type="text" maxlength="15" formControlName="userName">
                            </mat-form-field>
                        </div>
                        <div class="col-12 col-md-6">
                            <mat-form-field class="w-full">
                                <mat-label>Password(15)* </mat-label>
                                <input matInput type="text" maxlength="15" formControlName="password">
                            </mat-form-field>
                        </div>
                        <div class="col-12 col-md-6">
                            <mat-form-field class="w-full">
                                <mat-label>Default Commission (%)* </mat-label>
                                <input matInput type="number" (input)="_commonService.validateInput($event)"
                                    formControlName="defaultCommission">
                            </mat-form-field>
                        </div>
                        <div class="col-12 col-md-6">
                            <mat-form-field class="w-full">
                                <mat-label>Master FLPS User?</mat-label>
                                <mat-select matInput formControlName="blnAdmin">
                                    <mat-option [value]="false">No</mat-option>
                                    <mat-option [value]="true">Yes</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <div class="col-12 col-md-6">
                            <mat-form-field class="w-full">
                                <mat-label>Disabled</mat-label>
                                <mat-select matInput formControlName="blnActive">
                                    <mat-option [value]="false">No</mat-option>
                                    <mat-option [value]="true">Yes</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>

                        <div class="justify-end flex col-12">
                            <button [disabled]="isUpdateUserLoader" class="min-w-40" mat-stroked-button
                                [matTooltip]="'Update User'" (click)="updateUser()">
                                <mat-icon svgIcon="heroicons_solid:pencil" *ngIf="!isUpdateUserLoader"></mat-icon>
                                <span class="ml-2" *ngIf="!isUpdateUserLoader"> Update User </span>
                                <mat-progress-spinner *ngIf="isUpdateUserLoader" [diameter]="24"
                                    [mode]="'indeterminate'">
                                </mat-progress-spinner>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Remove User -->
            <div class="mt-5" *ngIf="mainScreenUser == 'Remove User'">
                <div class="shadow bg-card p-6">
                    <div class="row">
                        <div class="col-12 pb-5">
                            <h2 class="text-lg font-semibold">Remove User</h2>
                        </div>
                        <div class="col-12 mb-3">
                            <fuse-alert [appearance]="'soft'" [type]="'warning'" [showIcon]="false">
                                <p>
                                    NOTE: Removing an FLPS user will set all orders, stores, and store users associated
                                    with
                                    that user to the HOUSE USER. Click on "view orders" above to view all orders this
                                    FLPS
                                    user is associated with, and optionally reassign a new user.</p>
                                <p class="mt-2">

                                    Click on "view customers" above to view all the customers this FLPS user is
                                    associatd
                                    with, and optionally reassign a new user.
                                </p>
                                <p class="mt-2">
                                    Click on "store management" on the left to view default users for stores.</p>
                            </fuse-alert>
                        </div>
                        <div class="justify-end flex col-12">
                            <button [disabled]="updateUserData.delLoader" class="min-w-40" mat-stroked-button
                                [matTooltip]="'Remove User'" (click)="openDeleteModal(updateUserData, 'test')">
                                <mat-icon svgIcon="heroicons_solid:trash" *ngIf="!updateUserData.delLoader"></mat-icon>
                                <span class="ml-2" *ngIf="!updateUserData.delLoader"> Remove User </span>
                                <mat-progress-spinner *ngIf="updateUserData.delLoader" [diameter]="24"
                                    [mode]="'indeterminate'">
                                </mat-progress-spinner>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Blanket Customer Percentage -->
            <div class="mt-5" *ngIf="mainScreenUser == 'Blanket Customer Percentage'">
                <div class="shadow bg-card p-6">
                    <div class="row">
                        <div class="col-12 pb-5">
                            <h2 class="text-lg font-semibold">Blanket Customer Percentage</h2>
                        </div>
                        <div class="col-12">
                            <p>This tool will apply the percentage entered below to all customers for
                                {{updateUserData.firstName + ' ' + updateUserData.lastName}}</p>
                            <mat-form-field class="w-full">
                                <mat-label>Enter Percentage* </mat-label>
                                <input min="0" matInput type="number" [(ngModel)]="ngBlanketPercentage">
                                <span matSuffix>&nbsp; %</span>
                            </mat-form-field>
                        </div>
                        <div class="justify-end flex col-12">
                            <button [disabled]="isBlanketLoader" class="min-w-40" mat-stroked-button
                                [matTooltip]="'Apply'" (click)="addBlanketPercentage()">
                                <mat-icon svgIcon="heroicons_solid:pencil" *ngIf="!isBlanketLoader"></mat-icon>
                                <span class="ml-2" *ngIf="!isBlanketLoader"> Apply </span>
                                <mat-progress-spinner *ngIf="isBlanketLoader" [diameter]="24" [mode]="'indeterminate'">
                                </mat-progress-spinner>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- View Orders -->
            <div class="mt-5" *ngIf="mainScreenUser == 'View Orders'">
                <div class="px-5" *ngIf="ordersLoader">
                    <ngx-skeleton-loader count="8" appearance="line" animation="pulse" [theme]="{ 
                        'background-color': '#dedede'
                      }">
                    </ngx-skeleton-loader>
                </div>
                <div *ngIf="ordersDataSource.length > 0 && !ordersLoader;else other_content" class="w-full">
                    <table mat-table [dataSource]="ordersDataSource" class="w-full border-t">
                        <ng-container matColumnDef="id">
                            <th mat-header-cell *matHeaderCellDef class="text-sm">
                                Order ID
                            </th>
                            <td mat-cell *matCellDef="let element" class="text-sm">
                                <a [routerLink]="['/apps/orders',element.fk_orderID]"
                                    target="_blank">{{element.fk_orderID}}</a>
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="date">
                            <th mat-header-cell *matHeaderCellDef class="text-sm">
                                Date
                            </th>
                            <td mat-cell *matCellDef="let element" class="text-sm">
                                {{element.orderDate | date}}
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="store">
                            <th mat-header-cell *matHeaderCellDef class="text-sm">
                                Store
                            </th>
                            <td mat-cell *matCellDef="let element" class="text-sm">
                                {{element.storeName}}
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="customer">
                            <th mat-header-cell *matHeaderCellDef class="text-sm">
                                Customer
                            </th>
                            <td mat-cell *matCellDef="let element" class="text-sm">
                                {{element.customerName}}
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="total">
                            <th mat-header-cell *matHeaderCellDef class="text-sm">
                                Total
                            </th>
                            <td mat-cell *matCellDef="let element" class="text-sm">
                                <span *ngIf="element.Total < 0">{{'(' + (element.Total * -1 | currency )+')'}}</span>
                                <span *ngIf="element.Total >= 0">{{element.Total | currency}}</span>
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="paid">
                            <th mat-header-cell *matHeaderCellDef class="text-sm">
                                Paid
                            </th>
                            <td mat-cell *matCellDef="let element" class="text-sm">
                                <span *ngIf="element.paymentDate" class="text-green-600">Paid</span>
                                <span *ngIf="!element.paymentDate" class="text-red-500">Not Paid</span>
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="cancel">
                            <th mat-header-cell *matHeaderCellDef class="text-sm">
                                Cancel
                            </th>
                            <td mat-cell *matCellDef="let element" class="text-sm">
                                <span *ngIf="element.blnCancelled" class="text-red-500">Cancelled</span>
                                <span *ngIf="!element.blnCancelled" class="text-green-600">Active</span>
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="status">
                            <th mat-header-cell *matHeaderCellDef class="text-sm">
                                Status
                            </th>
                            <td mat-cell *matCellDef="let element" class="text-sm">
                                <span
                                    class="{{element.statusData.statusColor}}">{{element.statusData.statusValue}}</span>
                            </td>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="displayedOrdersColumns;" class="h-18 bg-light"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedOrdersColumns;"
                            class="h-14 hover:bg-gray-100 dark:hover:bg-hover" style="cursor: pointer;">
                        </tr>
                    </table>
                    <mat-paginator #paginator
                        class="border-b sm:border-t sm:border-b-0 z-10 bg-gray-50 dark:bg-transparent"
                        [ngClass]="{'pointer-events-none': ordersLoader}" [length]="totalOrders"
                        [pageIndex]="ordersPage-1" [pageSize]="20" (page)="getNextOrderdData($event)"
                        [hidePageSize]="true">
                    </mat-paginator>
                </div>
                <!-- No color Found -->
                <ng-template #other_content>
                    <div class="text-secondary font-semibold p-5 text-center" *ngIf="!ordersLoader">
                        There are no orders associated with this FLPS user.
                    </div>
                </ng-template>
            </div>
            <!-- View Customers -->
            <div class="mt-5" *ngIf="mainScreenUser == 'View Customers'">
                <div class="bg-card p-5">
                    <ngx-skeleton-loader *ngIf="customersLoader" count="8" appearance="line" animation="pulse">
                    </ngx-skeleton-loader>
                    <div *ngIf="!customersLoader">
                        <p class="text-lg font-semibold">Customers Associated With FLPS User
                            {{this.updateUserData.firstName + ' ' + this.updateUserData.lastName}}</p>
                        <div class="flex justify-between">
                            <p>{{totalCustomers}} Customers</p>
                            <button class="min-w-50" mat-stroked-button [disabled]="fileDownloadLoader"
                                (click)="downloadExcelWorkSheet()">
                                <mat-icon *ngIf="!fileDownloadLoader" svgIcon="heroicons_outline:download"></mat-icon>
                                <span *ngIf="!fileDownloadLoader">Download Excel File</span>
                                <mat-progress-spinner *ngIf="fileDownloadLoader" [diameter]="24"
                                    [mode]="'indeterminate'">
                                </mat-progress-spinner>
                            </button>
                        </div>
                        <!-- Filter -->
                        <div class="row border-b pb-5">
                            <div class="col-12 col-md-5">
                                <mat-form-field class="w-full">
                                    <mat-label>Select a store</mat-label>
                                    <mat-select matInput [(ngModel)]="selectedStore">
                                        <mat-option *ngFor="let item of activeStores" [value]="item">
                                            <span>{{item.storeName}}</span></mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            <div class="col-12 col-md-5">
                                <mat-form-field class="w-full">
                                    <mat-label>Search Keyword</mat-label>
                                    <input matInput [(ngModel)]="searchKeyword">
                                </mat-form-field>
                            </div>
                            <div class="col-12 col-md-2 text-right">
                                <button class="w-full rounded-md mt-6" mat-button mat-flat-button color="primary"
                                    [disabled]="isFilterCustomerLoader" (click)="filterCustomers()">
                                    <span *ngIf="!isFilterCustomerLoader">Filter</span>
                                    <mat-progress-spinner *ngIf="isFilterCustomerLoader" [diameter]="24"
                                        [mode]="'indeterminate'">
                                    </mat-progress-spinner>
                                </button>
                            </div>
                        </div>
                        <!-- Bulk Customer Update -->
                        <div class="row pt-5">
                            <div class="col-12">
                                <p class="text-lg font-semibold">Bulk customer update</p>
                                <p>This tool will update all customers associated with this FLPS user to a new FLPS user
                                    of your choice.</p>
                            </div>
                            <div class="col-12 col-md-5">
                                <mat-form-field class="w-full">
                                    <mat-label>Select a new user:</mat-label>
                                    <mat-select matInput [(ngModel)]="selectedEmployee">
                                        <mat-option [value]="''">Select FLPS User</mat-option>
                                        <mat-option *ngFor="let item of employeeAdmins" [value]="item.pk_userID">
                                            <span>{{item.fullName}}</span></mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            <div class="col-12 col-md-5">
                                <mat-form-field class="w-full">
                                    <mat-label>Select a store</mat-label>
                                    <mat-select matInput [(ngModel)]="selectedBulkStore">
                                        <mat-option [value]="''">Select a store</mat-option>
                                        <mat-option *ngFor="let item of bulkStoreList" [value]="item.pk_storeID">
                                            <span>{{item.storeName}}</span></mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            <div class="col-12 col-md-2 text-right">
                                <button class="w-full rounded-md mt-6" mat-button mat-flat-button color="primary"
                                    [disabled]="updateUserData.bulkLoader" (click)="openUpdateBulkCustomerModal()">
                                    <span *ngIf="!updateUserData.bulkLoader">Update</span>
                                    <mat-progress-spinner *ngIf="updateUserData.bulkLoader" [diameter]="24"
                                        [mode]="'indeterminate'">
                                    </mat-progress-spinner>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div *ngIf="customersDataSource.length > 0 && !customersLoader;else other_content" class="w-full">
                    <table mat-table [dataSource]="customersDataSource" class="w-full border-t">
                        <ng-container matColumnDef="id">
                            <th mat-header-cell *matHeaderCellDef>
                                ID
                            </th>
                            <td mat-cell *matCellDef="let element" class="min-w-15 w-15">
                                <a [routerLink]="['/apps/customers',element.fk_FLPSUserID]"
                                    target="_blank">{{element.fk_FLPSUserID || not_available}}</a>
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="name">
                            <th mat-header-cell *matHeaderCellDef>
                                Name
                            </th>
                            <td mat-cell *matCellDef="let element">
                                {{element.firstName + element.lastName}}
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="company">
                            <th mat-header-cell *matHeaderCellDef>
                                Company
                            </th>
                            <td mat-cell *matCellDef="let element">
                                {{element.companyName}}
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="email">
                            <th mat-header-cell *matHeaderCellDef>
                                Email
                            </th>
                            <td mat-cell *matCellDef="let element">
                                <a href="mailto:{{element.email}}">{{element.email}}</a>
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="last">
                            <th mat-header-cell *matHeaderCellDef>
                                Last Order
                            </th>
                            <td mat-cell *matCellDef="let element">
                                <!-- <mat-icon (click)="toggleUpdateUserData(element, true)"
                                    svgIcon="heroicons_outline:pencil-alt"></mat-icon> -->
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="commission">
                            <th mat-header-cell *matHeaderCellDef>
                                Commission
                            </th>
                            <td mat-cell *matCellDef="let element" class="min-w-10">
                                {{element.commission * 100}} %
                            </td>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="displayedCustomersColumns;" class="h-18 bg-light"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedCustomersColumns;"
                            class="h-14 hover:bg-gray-100 dark:hover:bg-hover" style="cursor: pointer;">
                        </tr>
                    </table>
                    <mat-paginator #paginator
                        class="border-b sm:border-t sm:border-b-0 z-10 bg-gray-50 dark:bg-transparent"
                        [ngClass]="{'pointer-events-none': customersLoader}" [length]="totalCustomers" [pageIndex]="0"
                        [pageSize]="20" (page)="getNextCustomersData($event)" [hidePageSize]="true">
                    </mat-paginator>
                </div>
                <!-- No color Found -->
                <ng-template #other_content>
                    <div class="text-secondary font-semibold p-5 text-center" *ngIf="!customersLoader">
                        There are no customers associated with this FLPS user.
                    </div>
                </ng-template>
            </div>
        </div>
    </div>
</div>


<div class="modal" tabindex="-1" role="dialog" #removeUser>
    <div class="modal-dialog" role="document" *ngIf="removeModalData">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{{removeModalData?.title}}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>{{removeModalData?.body}}</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn bg-gray-700 text-white rounded-md" color="primary"
                    *ngIf="removeModalData.check == 'main'" (click)="deleteCompany(removeModalData)">OK</button>
                <button type="button" class="btn bg-gray-700 text-white rounded-md" color="primary"
                    *ngIf="removeModalData.check == 'term'" (click)="deleteTerm(removeModalData)">OK</button>
                <button type="button" class="btn bg-red-500 text-white border-red-500 rounded-md"
                    data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<div class="modal" tabindex="-1" role="dialog" #updateBulkModal>
    <div class="modal-dialog" role="document" *ngIf="updateUserData">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Bulk Customer Update</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to update all of these customers to this new FLPS user? This cannot be undone.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn bg-gray-700 text-white rounded-md" color="primary"
                    (click)="updateBulkCustomer()">OK</button>
                <button type="button" class="btn bg-red-500 text-white border-red-500 rounded-md"
                    data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>