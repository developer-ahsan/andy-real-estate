<ngx-skeleton-loader count="8" appearance="line" animation="pulse" *ngIf="isLoading">
</ngx-skeleton-loader>
<div class="row m-0" *ngIf="!isLoading">
    <div class="col-12 my-2">
        <mat-button-toggle-group #group="matButtonToggleGroup" [value]="mainScreen"
            (change)="calledScreen(group.value)">
            <mat-button-toggle value="Surveys">
                Surveys
            </mat-button-toggle>
            <mat-button-toggle value="Hidden">
                Hidden Surveys
            </mat-button-toggle>
            <mat-button-toggle value="add">
                Add Survey
            </mat-button-toggle>
        </mat-button-toggle-group>
    </div>
    <div class="col-12 p-10 my-2 bg-card rounded-2xl shadow">
        <!-- Select a store -->
        <div *ngIf="mainScreen === 'Surveys'">

            <div *ngIf="!isUpdateSurveys" class="row">
                <div class="text-2xl font-extrabold tracking-tight leading-none my-2">
                    Current store surveys
                </div>
                <div class="col-12 font-medium mb-5">
                    Surveys can only be sent to customers once they've been finalized.
                    Finalized surveys cannot be deleted or modified.
                </div>

                <div class="col-12" *ngIf="dataSourceLoading">
                    <ngx-skeleton-loader count="8" appearance="line" animation="pulse" *ngIf="dataSourceLoading">
                    </ngx-skeleton-loader>
                </div>

                <div class="col-12 overflow-x-auto" *ngIf="!dataSourceLoading">
                    <ng-container *ngIf="dataSource.length > 0; else noRecords">
                        <table mat-table [dataSource]="dataSource" class="w-full">
                            <!-- pk_surveyID Column -->
                            <ng-container matColumnDef="pk_surveyID">
                                <th class="min-w-16 dark:bg-black dark:bg-opacity-5" mat-header-cell *matHeaderCellDef>
                                    ID
                                </th>
                                <td mat-cell *matCellDef="let element">{{ element.pk_surveyID }}</td>
                            </ng-container>

                            <!-- Date created Column -->
                            <ng-container matColumnDef="dateCreated">
                                <th class="min-w-24 dark:bg-black dark:bg-opacity-5" mat-header-cell *matHeaderCellDef>
                                    Date created
                                </th>
                                <td mat-cell *matCellDef="let element">
                                    {{ element.dateCreated}}
                                </td>
                            </ng-container>

                            <!-- Name Column -->
                            <ng-container matColumnDef="name">
                                <th class=" dark:bg-black dark:bg-opacity-5" mat-header-cell *matHeaderCellDef>
                                    Name
                                </th>
                                <td mat-cell *matCellDef="let element">
                                    {{ element.name}}
                                </td>
                            </ng-container>

                            <!-- Finalized Column -->
                            <ng-container matColumnDef="blnFinalized">
                                <th class="text-center dark:bg-black dark:bg-opacity-5" mat-header-cell
                                    *matHeaderCellDef>
                                    Finalized <span class="fa fa-question-circle"
                                        matTooltip="Finalized surveys can no longer be modified and are made available to be sent to customers."></span>
                                </th>
                                <td mat-cell *matCellDef="let element">
                                    <span *ngIf="element.blnFinalized"
                                        class="inline-flex items-center font-bold text-xs px-2.5 py-0.5 rounded-full tracking-wide uppercase bg-green-200 text-green-800 dark:bg-green-600 dark:text-green-50"><span
                                            class="leading-relaxed whitespace-nowrap">Finalized</span></span>
                                    <span *ngIf="!element.blnFinalized"
                                        class="inline-flex items-center font-bold text-xs px-2.5 py-0.5 rounded-full tracking-wide uppercase bg-red-200 text-red-800 dark:bg-red-600 dark:text-red-50"><span
                                            class="leading-relaxed whitespace-nowrap">Not finalized</span></span>
                                </td>
                            </ng-container>

                            <!-- Automated Column -->
                            <ng-container matColumnDef="blnAutomate">
                                <th class="text-center dark:bg-black dark:bg-opacity-5" mat-header-cell
                                    *matHeaderCellDef>
                                    Automated <span class="fa fa-question-circle"
                                        matTooltip="Automated surveys will go out automatically to customers 7 days after payment, and again after 14 days."></span>
                                </th>
                                <td mat-cell *matCellDef="let element">
                                    <mat-icon class="text-green-400 icon-size-5" *ngIf="element.blnAutomate"
                                        [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                    <mat-icon class="text-gray-400 icon-size-5" *ngIf="!element.blnAutomate"
                                        [svgIcon]="'heroicons_solid:x'">
                                    </mat-icon>
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="actions">
                                <th class="dark:bg-black dark:bg-opacity-5" mat-header-cell *matHeaderCellDef>

                                </th>
                                <td mat-cell *matCellDef="let element">
                                    <div class="flex flex-row gap-x-3 ml-2">
                                        <button (click)="updateSurveyToggle(element)" type="submit"
                                            class="btn btn-primary wide px-2" title="Edit"><span
                                                class="fa fa-pencil fa-lg"></span></button>
                                        <button type="submit" class="btn btn-danger wide px-2" title="Remove"><span
                                                class="fa fa-trash fa-lg"></span></button>
                                        <button type="submit" class="btn btn-success wide px-2" title="Finalize"><span
                                                class="fa fa-check fa-lg"></span></button>
                                        <button type="submit" class="btn btn-primary wide px-2"
                                            title="Turn on automation.  Automating a survey means it will be sent out to customers automatically 7 days after payment, and again after 14 days."><span
                                                class="fa fa-clock-o fa-lg"></span></button>
                                        <button type="submit" class="btn btn-primary wide px-2"
                                            title="Survey analytics"><span
                                                class="fa fa-pie-chart fa-lg"></span></button>
                                        <button type="submit" title="Hide" class="btn btn-primary wide px-2"><span
                                                class="fa fa-eye-slash fa-lg"></span></button>
                                    </div>
                                </td>
                            </ng-container>

                            <tr mat-header-row class="h-16" *matHeaderRowDef="displayedColumns"></tr>
                            <tr mat-row class="hover:bg-gray-100 dark:hover:bg-hover h-16" style="cursor: pointer;"
                                *matRowDef="let row; columns: displayedColumns"></tr>
                        </table>
                    </ng-container>
                    <ng-template #noRecords>
                        <div class="font-semibold tracking-tight text-center">
                            <p>No record found</p>
                        </div>
                    </ng-template>
                </div>
            </div>

            <div *ngIf="isUpdateSurveys">
                <div class="text-2xl font-extrabold tracking-tight leading-none my-3">
                    Update survey
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <mat-form-field appearance="fill" class="w-full">
                            <mat-label>Name</mat-label>
                            <input matInput placeholder="Name" [(ngModel)]="surveyName">
                        </mat-form-field>
                    </div>
                    <div class="col-12 flex justify-end">
                        <div class="items-center">
                            <div class="flex items-center my-2">
                                <!-- <div class="flex items-center mr-4" *ngIf="flashMessage">
                                    <ng-container *ngIf="flashMessage === 'success'">
                                        <mat-icon class="text-green-500" [svgIcon]="'heroicons_outline:check'">
                                        </mat-icon>
                                        <span class="ml-2">Survey added successfully</span>
                                    </ng-container>
                                    <ng-container *ngIf="flashMessage === 'error'">
                                        <mat-icon class="text-red-500" [svgIcon]="'heroicons_outline:x'"></mat-icon>
                                        <span class="ml-2">An error occurred, try again!</span>
                                    </ng-container>
                                </div> -->
                                <button class="min-w-40" mat-stroked-button [matTooltip]="'Add new survey'"
                                    (click)="back()">
                                    <span class="ml-1 mr-1">Back</span>
                                </button>
                                <button class="ml-2 min-w-40" mat-stroked-button [matTooltip]="'Update survey'"
                                    (click)="addSurvey()" [disabled]="isUpdate">
                                    <mat-progress-spinner *ngIf="isUpdate" [diameter]="24" [mode]="'indeterminate'">
                                    </mat-progress-spinner>
                                    <mat-icon *ngIf="!isUpdate" svgIcon="heroicons_outline:plus"></mat-icon>
                                    <span *ngIf="!isUpdate" class="ml-1 mr-1">Update Survey</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>


        <div *ngIf="mainScreen === 'Hidden'">
            <div class="text-2xl font-extrabold tracking-tight leading-none my-2">
                Hidden Surverys
                <div class="row">
                    <div class="col-12" *ngIf="dataSourceLoading">
                        <ngx-skeleton-loader count="8" appearance="line" animation="pulse" *ngIf="dataSourceLoading">
                        </ngx-skeleton-loader>
                    </div>

                    <div class="col-12 overflow-x-auto" *ngIf="!dataSourceLoading">
                        <ng-container *ngIf="dataSource.length > 0; else noRecords">
                            <table mat-table [dataSource]="dataSource" class="w-full">
                                <!-- pk_surveyID Column -->
                                <ng-container matColumnDef="pk_surveyID">
                                    <th class="min-w-16 dark:bg-black dark:bg-opacity-5" mat-header-cell
                                        *matHeaderCellDef>
                                        ID
                                    </th>
                                    <td class="font-medium" mat-cell *matCellDef="let element">{{ element.pk_surveyID }}
                                    </td>
                                </ng-container>

                                <!-- Date created Column -->
                                <ng-container matColumnDef="dateCreated">
                                    <th class="min-w-24 dark:bg-black dark:bg-opacity-5" mat-header-cell
                                        *matHeaderCellDef>
                                        Date created
                                    </th>
                                    <td class="font-medium" mat-cell *matCellDef="let element">
                                        {{ element.dateCreated}}
                                    </td>
                                </ng-container>

                                <!-- Name Column -->
                                <ng-container matColumnDef="name">
                                    <th class=" dark:bg-black dark:bg-opacity-5" mat-header-cell *matHeaderCellDef>
                                        Name
                                    </th>
                                    <td class="font-medium" mat-cell *matCellDef="let element">
                                        {{ element.name}}
                                    </td>
                                </ng-container>

                                <!-- Finalized Column -->
                                <ng-container matColumnDef="blnFinalized">
                                    <th class="text-center dark:bg-black dark:bg-opacity-5" mat-header-cell
                                        *matHeaderCellDef>
                                        Finalized <span class="fa fa-question-circle"
                                            matTooltip="Finalized surveys can no longer be modified and are made available to be sent to customers."></span>
                                    </th>
                                    <td mat-cell *matCellDef="let element">
                                        <span *ngIf="element.blnFinalized"
                                            class="inline-flex items-center font-bold text-xs px-2.5 py-0.5 rounded-full tracking-wide uppercase bg-green-200 text-green-800 dark:bg-green-600 dark:text-green-50"><span
                                                class="leading-relaxed whitespace-nowrap">Finalized</span></span>
                                        <span *ngIf="!element.blnFinalized"
                                            class="inline-flex items-center font-bold text-xs px-2.5 py-0.5 rounded-full tracking-wide uppercase bg-red-200 text-red-800 dark:bg-red-600 dark:text-red-50"><span
                                                class="leading-relaxed whitespace-nowrap">Not finalized</span></span>
                                    </td>
                                </ng-container>

                                <!-- Automated Column -->
                                <ng-container matColumnDef="blnAutomate">
                                    <th class="text-center dark:bg-black dark:bg-opacity-5" mat-header-cell
                                        *matHeaderCellDef>
                                        Automated <span class="fa fa-question-circle"
                                            matTooltip="Automated surveys will go out automatically to customers 7 days after payment, and again after 14 days."></span>
                                    </th>
                                    <td mat-cell *matCellDef="let element">
                                        <mat-icon class="text-green-400 icon-size-5" *ngIf="element.blnAutomate"
                                            [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                        <mat-icon class="text-gray-400 icon-size-5" *ngIf="!element.blnAutomate"
                                            [svgIcon]="'heroicons_solid:x'">
                                        </mat-icon>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="actions">
                                    <th class="dark:bg-black dark:bg-opacity-5" mat-header-cell *matHeaderCellDef>

                                    </th>
                                    <td mat-cell *matCellDef="let element">
                                        <button type="submit" title="Unhide"
                                            class="btn btn-primary btn-xs wide px-2"><span
                                                class="fa fa-eye fa-lg"></span></button>

                                    </td>
                                </ng-container>

                                <tr mat-header-row class="h-16" *matHeaderRowDef="displayedColumns"></tr>
                                <tr mat-row class="hover:bg-gray-100 dark:hover:bg-hover h-16" style="cursor: pointer;"
                                    *matRowDef="let row; columns: displayedColumns"></tr>
                            </table>
                        </ng-container>
                        <ng-template #noRecords>
                            <div class="font-semibold tracking-tight text-center">
                                <p>No record found</p>
                            </div>
                        </ng-template>
                    </div>
                </div>
            </div>


        </div>

        <!-- <div class="col-12 my-2 bg-card sm:p-6 md:p-6 lg:p-16 rounded-2xl shadow"> -->
        <!-- Select a store -->
        <!-- <div class="text-2xl font-extrabold tracking-tight leading-none my-3">
            Add Survey Header
        </div>
        <div class="row mt-3">
            <div class="col-12 text-secondary">There is no header image uploaded for this store's survey pages.</div>

            <div class="col-12">
                <p style="margin-bottom: 5px; color: red">
                    1500px W by 300px H JPG only!
                </p>
                <br />
                <input type="file" class="file-upload" />
            </div>
        </div>
        <div class="col-12 mt-3">
            <button mat-flat-button [matTooltip]="'Add Survey header image'" class="float-right" [color]="'primary'">
                <span class="px-2">Add Survey header image</span>
            </button>
        </div>
    </div> -->

        <div *ngIf="mainScreen === 'add'" class="col-12 my-2 p-10 rounded-2xl">
            <!-- Select a store -->
            <div class="text-2xl font-extrabold tracking-tight leading-none my-3">
                Add new survey
            </div>
            <div class="row mt-3">
                <div class="col-12">
                    <mat-form-field appearance="fill" class="w-full">
                        <mat-label>Name</mat-label>
                        <input matInput placeholder="Name" (input)="setAddSurvey($event)">
                    </mat-form-field>
                </div>
                <div class="col-12 flex justify-end">
                    <div class="items-center">
                        <div class="flex items-center my-2">
                            <div class="flex items-center mr-4" *ngIf="flashMessage">
                                <ng-container *ngIf="flashMessage === 'success'">
                                    <mat-icon class="text-green-500" [svgIcon]="'heroicons_outline:check'">
                                    </mat-icon>
                                    <span class="ml-2">Survey added successfully</span>
                                </ng-container>
                                <ng-container *ngIf="flashMessage === 'error'">
                                    <mat-icon class="text-red-500" [svgIcon]="'heroicons_outline:x'"></mat-icon>
                                    <span class="ml-2">An error occurred, try again!</span>
                                </ng-container>
                            </div>
                            <button class="min-w-40" mat-stroked-button [matTooltip]="'Add new survey'"
                                (click)="addSurvey()" [disabled]="isUpdate">
                                <mat-progress-spinner *ngIf="isUpdate" [diameter]="24" [mode]="'indeterminate'">
                                </mat-progress-spinner>
                                <mat-icon *ngIf="!isUpdate" svgIcon="heroicons_outline:plus"></mat-icon>
                                <span *ngIf="!isUpdate" class="ml-1 mr-1">Add Survey</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>