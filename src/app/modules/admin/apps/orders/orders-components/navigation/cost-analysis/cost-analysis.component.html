<ngx-skeleton-loader count="8" appearance="line" animation="pulse" *ngIf="isLoading">
</ngx-skeleton-loader>
<div class="row" *ngIf="!isLoading" cdkScrollable>
    <div class="col-12 my-2">
        <fuse-card class="rounded-2xl shadow bg-card flex flex-col lg:flex-row w-full">
            <div class="p-6 sm:p-8 lg:p-10 w-full">
                <div class="text-2xl font-bold ">
                    Cost Analysis
                </div>
                <div class="row mt-1 w-full">
                    <div class="col-12 mb-3">
                        <!-- <button class="float-right mr-3" mat-stroked-button [matTooltip]="'Save report as PDF'"
                            (click)="exportHtmlToPDF()">
                            <mat-icon svgIcon="mat_outline:picture_as_pdf"></mat-icon>
                            <span class="ml-2 mr-1">PDF</span>
                        </button> -->
                    </div>
                    <div class="col-12 text-center print:overflow-visible" cdkScrollable>
                        <div class="inline-block  text-left print:p-0 w-full" id="htmltable" #htmltable>

                            <!-- Invoice -->
                            <div
                                class="print:w-auto print:p-0 print:rounded-none print:shadow-none print:bg-transparent">

                                <div class="flex items-start">
                                    <div class="grid grid-rows-1 mt-2">
                                        <div class="grid auto-cols-max grid-flow-col gap-x-2">
                                            <div class="w-100 text-left text-2xl text-secondary">
                                                Confidential Cost Analysis Report
                                            </div>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-x-4 gap-y-1 ml-auto ">
                                        <div
                                            class="justify-self-start font-semibold text-secondary text-3xl tracking-tight">
                                            Order
                                        </div>
                                        <div class="justify-self-start text-3xl font-semibold">
                                            #{{selectedOrder.pk_orderID}}</div>
                                        <div class="justify-self-start font-medium tracking-tight text-secondary">ORDER
                                            DATE</div>
                                        <div class="font-medium">{{selectedOrder?.orderDate ||
                                            not_available}}</div>
                                        <div class="justify-self-start font-medium tracking-tight text-secondary">
                                            Payment Date
                                        </div>
                                        <div class="font-medium">{{(selectedOrder?.paymentDate | date:'medium') ||
                                            not_available}}</div>
                                        <div class="justify-self-start font-medium tracking-tight text-secondary">
                                            Purchase Order</div>
                                        <div class="font-medium">{{selectedOrder?.purchaseOrderNum ||
                                            not_available}}</div>
                                    </div>
                                </div>

                                <div class="grid grid-cols-12 gap-x-1 mt-8" *ngIf="orderProducts?.length > 0">
                                    <div class="col-span-12 border-b" *ngFor="let item of orderProducts">
                                        <div class="row ">
                                            <div class="col-9">
                                                <p class="font-bold text-medium">
                                                    ({{item.products[0]?.pk_productID}})
                                                    {{item.products[0]?.productNumber}}:
                                                    {{item.products[0]?.productName}}
                                                </p>
                                                <p class="font-medium text-secondary text-md py-2">QUANTITY:
                                                    {{item.totalQuantity}}</p>
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-12 gap-x-1 mt-1">
                                            <div class="col-span-5 font-medium text-md text-secondary">DETAILS</div>
                                            <div class="font-medium text-md text-center text-secondary">QTY</div>
                                            <div class="font-medium col-span-2  text-md text-center text-secondary">
                                                <p>COST</p>
                                                <!-- <p>unit*qty</p> -->
                                            </div>
                                            <div class="font-medium col-span-2 text-md text-center text-secondary">
                                                <p>PRICE</p>
                                                <!-- <p>price*qty</p> -->
                                            </div>
                                            <div class="font-medium col-span-1 text-md text-center text-secondary">
                                                $
                                            </div>
                                            <div class="font-medium col-span-1 text-md text-center text-secondary">
                                                Margin %
                                            </div>

                                            <!-- Divider -->
                                            <div class="col-span-12 my-3 border-b"></div>
                                            <div class="col-span-6 font-medium font-bold text-md">
                                                <p>COLOR/SIZE BREAKDOWN</p>
                                            </div>
                                            <div class="font-medium col-span-1  text-md text-center text-secondary">
                                                <p>Unit</p>
                                            </div>
                                            <div class="font-medium col-span-1  text-md text-center text-secondary">
                                                <p>Total</p>
                                            </div>
                                            <div class="font-medium col-span-1  text-md text-center text-secondary">
                                                <p>Price</p>
                                            </div>
                                            <div class="font-medium col-span-1  text-md text-center text-secondary">
                                                <p>Total</p>
                                            </div>
                                            <!-- Colors -->
                                            <div class="col-span-12 my-2" *ngFor="let colors of item.products">
                                                <div class="grid grid-cols-12">
                                                    <div class="col-span-5 font-medium text-md text-secondary">
                                                        <p>{{colors.colorName}} <span *ngIf="colors.sizeName"> &
                                                                {{colors.sizeName}}</span></p>
                                                    </div>
                                                    <div class="font-medium text-md  text-center text-secondary">
                                                        {{colors.quantity}}</div>
                                                    <div
                                                        class="col-span-1 text-center font-medium text-md text-secondary">
                                                        <p>{{colors.cost}}</p>
                                                    </div>
                                                    <div
                                                        class="col-span-1 text-center font-medium text-md  text-secondary">
                                                        {{(colors.cost * colors.quantity).toFixed(2) }}
                                                    </div>
                                                    <div
                                                        class="col-span-1 text-center font-medium text-md text-secondary">
                                                        <p>{{colors.price}}</p>
                                                    </div>
                                                    <div
                                                        class="col-span-1 text-center font-medium text-md  text-secondary">
                                                        {{(colors.price * colors.quantity).toFixed(2) }}
                                                    </div>
                                                    <div
                                                        class="text-center font-medium col-span-1 text-md text-secondary">
                                                        <p>{{((colors.price * colors.quantity) - (colors.cost *
                                                            colors.quantity)).toFixed(2) }}</p>
                                                    </div>
                                                    <div
                                                        class="text-center font-medium col-span-1 text-md text-secondary">
                                                        <p>{{(( 1 - (colors.cost/colors.price))*100).toFixed(2)}} %</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Imprints -->
                                            <div class="mt-2 col-span-12 font-medium font-bold text-md">
                                                <p>IMPRINTS</p>
                                            </div>
                                            <div class="col-span-12 my-2" *ngFor="let imprint of item.imprints">
                                                <div class="grid grid-cols-12">

                                                    <div class="col-span-5 font-medium text-md text-secondary">
                                                        <p>{{imprint?.locationName}} | {{imprint?.methodName}} |
                                                            Processes: {{imprint?.processQuantity}}</p>
                                                    </div>
                                                    <div class="font-medium text-md  text-center text-secondary">
                                                        {{imprint?.quantity}}
                                                    </div>
                                                    <div
                                                        class=" col-span-1 text-center font-medium text-md  text-secondary">
                                                        {{(imprint?.runCost)}}
                                                    </div>
                                                    <div
                                                        class=" col-span-1 text-center font-medium text-md  text-secondary">
                                                        {{(imprint?.runCost * imprint?.quantity).toFixed(2)}}
                                                    </div>
                                                    <div
                                                        class=" col-span-1 text-center font-medium text-md  text-secondary">
                                                        {{(imprint?.runPrice)}}
                                                    </div>
                                                    <div
                                                        class=" col-span-1 text-center font-medium text-md  text-secondary">
                                                        {{(imprint?.runPrice *
                                                        imprint?.quantity).toFixed(2)}}
                                                    </div>
                                                    <div
                                                        class=" col-span-1 text-center font-medium text-md  text-secondary">
                                                        {{(imprint?.runPrice - imprint?.runCost).toFixed(2)}}
                                                    </div>
                                                    <div
                                                        class="text-center font-medium col-span-1 text-md text-secondary">
                                                        <p>{{getPercentage(imprint,'imprints').toFixed(2)}} %</p>
                                                    </div>
                                                    <!-- Setups -->
                                                    <div
                                                        class="mt-2 col-span-5 font-medium text-right text-md text-secondary">
                                                        <p>Setup(s)</p>
                                                    </div>
                                                    <div class="font-medium text-md  text-center text-secondary">
                                                    </div>
                                                    <div
                                                        class="mt-2 col-span-1 text-center font-medium text-md  text-secondary">
                                                    </div>
                                                    <div
                                                        class="mt-2 col-span-1 text-center font-medium text-md  text-secondary">
                                                        {{(imprint?.setupCost)}}
                                                    </div>
                                                    <div
                                                        class="mt-2 text-center font-medium col-span-1 text-md text-secondary">

                                                    </div>
                                                    <div
                                                        class="mt-2 col-span-1 text-center font-medium text-md  text-secondary">
                                                        {{(imprint?.setupPrice)}}
                                                    </div>
                                                    <div
                                                        class="mt-2 col-span-1 text-center font-medium text-md  text-secondary">
                                                        {{(imprint?.setupPrice - imprint?.setupCost).toFixed(2)}}
                                                    </div>
                                                    <div
                                                        class="mt-2 text-center font-medium col-span-1 text-md text-secondary">
                                                        <p>{{getPercentage(imprint,'setup').toFixed(2)}} %
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- ACCESSORIES -->
                                            <div class="mt-2 col-span-12 font-medium font-bold text-md ">
                                                <p>ACCESSORIES</p>
                                            </div>
                                            <div class="col-span-12 my-2" *ngFor="let access of item.accessories">
                                                <div class="grid grid-cols-12">
                                                    <div class=" col-span-5 font-medium text-md text-secondary">
                                                        <p>{{access.packagingName}}</p>
                                                    </div>
                                                    <div class=" font-medium text-md  text-center text-secondary">
                                                        {{access.quantity}}</div>
                                                    <div
                                                        class="font-medium text-md text-secondary col-span-1 text-center">
                                                        {{access?.runCost}}</div>
                                                    <div
                                                        class="font-medium text-md text-secondary col-span-1 text-center">
                                                        {{(access?.runCost * access.quantity).toFixed(2)}}</div>
                                                    <!-- <div class="col-span-1"></div> -->
                                                    <div
                                                        class="font-medium text-md text-secondary col-span-1 text-center">
                                                        {{access?.runPrice}}</div>
                                                    <div
                                                        class="font-medium text-md text-secondary col-span-1 text-center">
                                                        {{(access?.runPrice * access.quantity).toFixed(2)}}</div>
                                                    <div
                                                        class="col-span-1 font-medium text-md text-secondary text-center">
                                                        {{(access?.runPrice -
                                                        access?.runCost).toFixed(2)}}</div>
                                                    <div
                                                        class=" col-span-1 text-center font-medium text-md text-secondary">
                                                        {{((1- (access?.runCost/access?.runPrice))*100).toFixed(2)}} %
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- SHIPPING & HANDLING	 -->
                                            <div class="mt-2 col-span-5 font-medium font-bold text-md mb-4">
                                                <p>SHIPPING & HANDLING</p>
                                            </div>
                                            <div class="font-medium text-md  text-center text-secondary"></div>
                                            <div class="col-span-1"></div>
                                            <div class="mt-2 col-span-1 text-secondary text-center font-medium text-md">
                                                {{item.products[0]?.shippingCost}}</div>
                                            <div class="col-span-1"></div>
                                            <div class="mt-2 col-span-1 text-secondary text-center font-medium text-md">
                                                {{item.products[0]?.shippingPrice}}</div>
                                            <div class="mt-2 col-span-1 text-secondary text-center font-medium text-md">
                                                {{(item.products[0]?.shippingPrice -
                                                item.products[0]?.shippingCost).toFixed(2)}}
                                            </div>
                                            <div class="mt-2 col-span-1 text-secondary text-center font-medium text-md">
                                                {{getPercentage(item, 'shipping').toFixed(2)}} %
                                            </div>

                                            <!-- Mechandise Subtotal -->
                                            <div class="mt-2 col-span-5 font-bold font-medium text-md  mb-4">
                                                <p>Merchandise SubTotal</p>
                                            </div>
                                            <div class="font-medium text-md  text-center text-secondary"></div>
                                            <div class="col-span-1"></div>
                                            <div class="mt-2 col-span-1 text-center font-medium text-md  font-bold">
                                                {{item.totalMercandiseCost.toFixed(2) | currency}}
                                                <!-- {{((item.imprints?.runCost * item.product?.quantity) +
                                                (item.product?.cost * item.product?.quantity) +
                                                (item.imprints?.setupCost) +(item.product?.shippingCost) ) | currency}} -->
                                            </div>
                                            <div class="col-span-1"></div>
                                            <div class="mt-2 text-center font-medium col-span-1 text-md font-bold">
                                                {{item.totalMerchendisePrice.toFixed(2) | currency}}
                                            </div>
                                            <div class="mt-2 text-center font-medium col-span-1 text-md font-bold">
                                                {{(item.totalMerchendisePrice - item.totalMercandiseCost).toFixed(2) |
                                                currency}}
                                            </div>
                                            <div class="mt-2 text-center font-medium col-span-1 text-md font-bold">
                                                {{((1 - (item.totalMerchendisePrice /
                                                item.totalMercandiseCost))*100).toFixed(2)}}%
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-span-5 self-center font-medium tracking-tight text-secondary">
                                        TOTAL DISCOUNT
                                    </div>
                                    <div class="font-medium text-md  text-center text-secondary"></div>
                                    <div class="col-span-1"></div>
                                    <div class="col-span-1"></div>
                                    <div class="col-span-1"></div>
                                    <div class="col-span-1 text-center  font-medium text-md">
                                        -{{orderTotal.discount.toFixed(2)}}
                                    </div>
                                    <div class="col-span-1 text-center  font-medium text-md">
                                        -{{orderTotal.discount.toFixed(2)}}
                                    </div>
                                    <div class="col-span-5 self-center font-medium tracking-tight text-secondary">
                                        TOTAL B T
                                    </div>
                                    <div class="font-medium text-md  text-center text-secondary"></div>
                                    <div class="col-span-1"></div>
                                    <div class="col-span-1 text-center  font-medium text-md">
                                        {{orderTotal.cost.toFixed(2)}}</div>
                                    <div class="col-span-1"></div>
                                    <div class="col-span-1 text-center  font-medium text-md">
                                        {{orderTotal.price.toFixed(2)}}
                                    </div>
                                    <div class="col-span-1 text-center  font-medium text-md">{{(orderTotal.price -
                                        orderTotal.cost).toFixed(2)}}
                                    </div>
                                    <div class="col-span-1 text-center  font-medium text-md">
                                        {{orderTotal.margin.toFixed(2)}}%
                                    </div>
                                    <div class="col-span-5 self-center font-medium tracking-tight text-secondary">
                                        TOTAL TAX
                                    </div>
                                    <div class="font-medium text-md  text-center text-secondary"></div>
                                    <div class="col-span-1"></div>
                                    <div class="col-span-1"></div>
                                    <div class="col-span-1  text-center  font-medium text-md"></div>
                                    <div class="col-span-1  text-center  font-medium text-md">{{orderTotal.tax}}</div>
                                    <!-- <div class="col-span-5 self-center font-medium tracking-tight text-secondary">
                                        ADJUSTMENTS
                                    </div> -->
                                    <!-- <div class="col-span-1  text-center  font-medium text-md">$0.00</div> -->
                                    <div class="col-span-5 self-center font-medium tracking-tight text-secondary">
                                        GRAND TOTAL
                                    </div>
                                    <div class="font-medium text-md  text-center text-secondary"></div>
                                    <div class="col-span-1"></div>
                                    <div class="col-span-1 text-center  font-medium text-md font-bold">
                                        {{orderTotal.cost.toFixed(2) | currency}}</div>
                                    <div class="col-span-1"></div>
                                    <div class="col-span-1 text-center  font-medium text-md font-bold">
                                        {{orderTotal.total.toFixed(2) | currency}}
                                    </div>
                                </div>




                                <div class="mt-10">
                                    <div style="text-align: -webkit-center;">
                                        <img class="w-40" src="assets/images/logo/consolidus-logo.jpeg">
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </fuse-card>
    </div>
</div>