<div class="w-full">
    <ngx-skeleton-loader count="15" appearance="line" animation="pulse" *ngIf="isLoading">
    </ngx-skeleton-loader>

    <div class="row" *ngIf="!isLoading && orderDetail">
        <div class="col-12 my-2">
            <div class="text-right">
                <button (click)="exportHtmlToPDF()" mat-flat-button color="primary" [disabled]="isGeneratePDFLoader"
                    [matTooltip]="'Save report as PDF'">
                    <mat-icon svgIcon="mat_outline:picture_as_pdf" *ngIf="!isGeneratePDFLoader"></mat-icon>
                    <span class="ml-2 mr-1" *ngIf="!isGeneratePDFLoader">PDF</span>
                    <mat-progress-spinner *ngIf="isGeneratePDFLoader" [diameter]="24" [mode]="'indeterminate'">
                    </mat-progress-spinner>
                </button>
            </div>
            <fuse-card class="rounded-2xl shadow bg-card flex flex-col lg:flex-row w-full" id="htmltable">
                <div class="p-6 sm:p-8 lg:p-10 w-full">
                    <div class="text-2xl font-bold ">
                        Original Report
                    </div>
                    <div>
                        <a [routerLink]="['/apps/orders',orderDetail.pk_orderID]" target="_blank"
                            class="font-bold underline">View this order in admin</a>
                    </div>
                    <div class="row w-full">
                        <div class="col-12 text-right">
                            <p class="font-bold">CONFIDENTIAL ORDER REPORT</p>
                            <p class="font-bold">#{{orderDetail.pk_orderID}}</p>
                            <p class="font-bold" *ngIf="orderDetail.fk_groupOrderID">{{orderDetail.fk_groupOrderID}}</p>
                        </div>
                        <div class="col-12">
                            <b>Total: </b> {{orderDetail?.orderTotal | currency: 'USD': 'symbol':'1.3-3'}}<br />
                            <b>Total Final Margin: </b> <span
                                *ngIf="orderDetail.orderPrice">{{orderDetail?.margin?.toFixed(3)}}%</span><br />
                            <b>Store: </b>{{orderDetail.storeName}}<br />
                            <b>Program manager: </b>
                            <span *ngIf="managerDetails">{{managerDetails[0] + ' ' + managerDetails[1]}}</span>
                            <span *ngIf="!managerDetails">N/A</span>
                            <br />
                            <b>Order Date: </b>{{orderDetail?.formattedCompleteOrderDate}}<br />
                            <b>Client: </b> {{orderDetail?.storeUserCompanyName}}
                            <ng-container *ngIf="orderDetail?.qryUserLocations;else departmentName">
                                - {{orderDetail?.attributeName}} - {{orderDetail?.locationName}}
                            </ng-container>
                            <ng-template #departmentName>
                                <p *ngIf="orderDetail?.storeUserDepartmentName">
                                    {{orderDetail?.storeUserDepartmentName}}
                                </p>
                            </ng-template>
                            <br />
                            <ng-container *ngIf="orderDetail.qryRoyalty">
                                <b>Referral Location:</b> {{orderDetail.royaltyData.state}} -
                                {{orderDetail.royaltyData.name}} ({{orderDetail.royaltyData.percentage}}%)<br />
                            </ng-container>
                            <b>User: </b>{{orderDetail?.userFirstName + ' ' + orderDetail?.userLastName}} (id:
                            {{orderDetail?.fk_storeUserID}})<br />
                            <b>Payment Method: </b> {{orderDetail?.paymentMethodName}} <br />
                            <b>Payment Date: </b> <span
                                *ngIf="orderDetail?.paymentDate">{{orderDetail.paymentDate}}</span><span
                                *ngIf="!orderDetail?.paymentDate">PENDING</span><br />
                            <b>Purchase Order:</b> <span
                                *ngIf="orderDetail?.purchaseOrderNum">{{orderDetail.purchaseOrderNum}}</span><span
                                *ngIf="!orderDetail?.purchaseOrderNum">NONE</span><br />
                            <span *ngIf="orderDetail.costCenterCode">
                                <b>Cost Center Code: </b> {{orderDetail.costCenterCode}}<br />
                            </span>
                            <b>In-Hands Date: </b>
                            <span *ngIf="orderDetail.inHandsDate">{{orderDetail.inHandsDate | date: 'EE, MM d y'}}
                                ** RUSH ORDER ***</span>
                            <span *ngIf="!orderDetail.inHandsDate">None requested</span><br />
                            <b>Shipping: </b> {{orderDetail?.shippingCarrierName}},
                            {{orderDetail.shippingServiceName}}<span
                                *ngIf="orderDetail?.shippingCustomerAccountNumber">, ACCT#:
                                {{orderDetail?.shippingCustomerAccountNumber}} *** CUSTOMER ACCOUNT ***</span><br />
                            <span *ngIf="orderDetail.shippingServiceName == 'UPS FREIGHT'">
                                <b>Dock: </b> <span>{{orderDetail.blnDock ? 'YES': 'NO'}}</span><br />
                            </span>
                            <b>Account/Charge Code: </b> <span>{{orderDetail?.accountChargeCode ?
                                orderDetail?.accountChargeCode : 'NONE'}} </span><br />
                            <span *ngIf="!orderDetail?.blnTaxable">
                                <b>Taxable: </b> NO *** TAX EXEMPT ***<br />
                                <b>Customer Notes: </b> {{orderDetail?.taxExemptionComment}}<br />
                            </span>
                            <b>Instructions: </b> <br />{{orderDetail?.instructions}}<br />
                            <b>Internal Comments:</b> <br />
                            <!-- <div class="border p-2"> -->
                            <div [innerHtml]="orderDetail?.internalComments"></div>
                            <!-- </div> -->
                            <br />
                            <b>PromoCode:</b> {{orderDetail?.discountCode || 'NONE'}}
                            <br />
                            <ng-container *ngFor="let qryOrderLine of qryOrderLines">
                                <hr class="my-2">
                                <table cellspacing="0" cellpadding="0" width="100%">
                                    <ng-container *ngIf="qryOrderLine.blnGroupRun;else notGroupRun">
                                        <tr>
                                            <td colspan="2">
                                                <div class="alert alert-warning text-center text-green-600 font-bold">
                                                    GROUP RUN MASTER
                                                    PRODUCT</div><br />
                                            </td>
                                        </tr>
                                    </ng-container>
                                    <ng-template #notGroupRun>
                                        <ng-container *ngIf="qryOrderLine.groupRunOrderLineID">
                                            <tr>
                                                <td colspan="2">
                                                    <div
                                                        class="alert alert-warning text-center text-green-600 font-bold">
                                                        GROUP RUN ITEM
                                                        ( <span [innerHTML]="qryOrderLine.productName"></span>)</div>
                                                    <br />
                                                </td>
                                            </tr>
                                        </ng-container>
                                    </ng-template>
                                    <tr>
                                        <td valign="top" width="80%">
                                            <b>(<a [routerLink]="['/apps/ecommerce/inventory',qryOrderLine.fk_productID]"
                                                    target="_blank">{{qryOrderLine.fk_productID}}</a>){{qryOrderLine.productNumber}}:
                                                <span [innerHTML]="qryOrderLine.productName"></span></b><br />
                                            <span style="color:#333; font-weight:bold;">PO:
                                                {{orderDetail.pk_orderID}}-{{qryOrderLine.pk_orderLineID}}</span><br />
                                            <ng-container *ngIf="qryOrderLine.estimatedShippingDate">
                                                <b>Estimated shipping date:</b>
                                                {{qryOrderLine.formattedEstimatedShippingDate}}<br />
                                            </ng-container>
                                            <ng-container *ngIf="qryOrderLine.trackingNumber">
                                                <b>Tracking:</b> {{qryOrderLine.trackingNumber}}<br />
                                            </ng-container>
                                            <ng-container>Quantity: {{qryOrderLine?.quantity}} <span
                                                    *ngIf="qryOrderLine.blnSample"><b> *
                                                        * * SAMPLE * * *</b></span>
                                                <span *ngIf="!qryOrderLine.blnSample && qryOrderLine.blnWarehouse"><b>
                                                        * * * FULFILLMENT ITEM * * *</b></span>
                                                <br />
                                            </ng-container>
                                            <ng-container *ngIf="qryOrderLine.blnWarehouse">
                                                <div style="color:#FF0000; font-weight: bold;">
                                                    <span *ngIf="qryOrderLine.event">Event:
                                                        {{qryOrderLine.event}}<br /></span>
                                                    <span *ngIf="qryOrderLine.eventDate">
                                                        Event Date: {{qryOrderLine.formattedEventDate}}<br />
                                                    </span>
                                                    <span *ngIf="qryOrderLine.warehouseCode">
                                                        Warehouse Code: {{qryOrderLine?.warehouseCode}}<br />
                                                    </span>
                                                </div>
                                                <br />
                                            </ng-container>
                                            Supplier: {{qryOrderLine.companyName}}
                                        </td>
                                        <td align="right" valign="top" width="20%">
                                            <img style="display: inline;width:50%"
                                                src="https://assets.consolidus.com/globalAssets/products/thumbnails/{{qryOrderLine?.pk_storeProductID}}.jpg"
                                                onError="this.src='https://assets.consolidus.com/globalAssets/Products/coming_soon.jpg'">
                                        </td>
                                    </tr>
                                </table>
                                <hr class="my-2">
                                <table width="100%">
                                    <tr height="1">
                                        <td width="50%"></td>
                                        <td width="10%"></td>
                                        <td width="10%"></td>
                                        <td width="10%"></td>
                                        <td width="10%"></td>
                                        <td width="10%"></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td align="center">QTY</td>
                                        <td colspan="2" align="center">COST</td>
                                        <td colspan="2" align="center">PRICE</td>
                                    </tr>
                                    <tr>
                                        <td colspan="2"></td>
                                        <td align="center">unit</td>
                                        <td align="center">total</td>
                                        <td align="center">unit</td>
                                        <td align="center">total</td>
                                    </tr>
                                    <!--- ITEM & OPTIONS --->
                                    <tr>
                                        <td colspan="6"><i>COLOR/SIZE BREAKDOWN</i></td>
                                    </tr>

                                    <ng-container *ngFor="let item of qryOrderLine.colorSizesData">
                                        <tr>
                                            <td>{{item.colorName}} <span *ngIf="item.sizeName">&amp;
                                                    {{item.sizeName}}</span></td>
                                            <td align="center">{{item.quantity}}</td>
                                            <td align="center">{{item.runCost | currency: 'USD': 'symbol':'1.3-3'}}</td>
                                            <td align="center">{{item.runCost * item.quantity | currency: 'USD':
                                                'symbol':'1.3-3'}}</td>
                                            <td align="center">{{item.runPrice | currency: 'USD': 'symbol':'1.3-3'}}
                                            </td>
                                            <td align="center">{{item.runPrice * item.quantity | currency: 'USD':
                                                'symbol':'1.3-3'}}</td>
                                        </tr>
                                        <ng-container *ngIf="item.setupCost || item.setupPrice">
                                            <tr>
                                                <td align="right">Color/Size Setup</td>
                                                <td align="center"></td>
                                                <td align="center"></td>
                                                <td align="center">{{item.setupCost | currency: 'USD':
                                                    'symbol':'1.3-3'}}</td>
                                                <td align="center"></td>
                                                <td align="center">{{item.setupPrice | currency: 'USD':
                                                    'symbol':'1.3-3'}}</td>
                                            </tr>
                                        </ng-container>
                                    </ng-container>
                                    <!--- IMPRINTS --->
                                    <tr>
                                        <td colspan="6"><br /><i>IMPRINTS</i></td>
                                    </tr>
                                    <ng-container *ngFor="let item of qryOrderLine.imprintsData">
                                        <tr>
                                            <td>{{item.locationName}} ({{item.methodName}})
                                                <span *ngIf="item.reorderNumber"><br /><span color="#FF0000"><b>Reorder
                                                            #:&nbsp; {{item.reorderNumber}}</b></span></span>
                                            </td>
                                            <td align="center">{{item.quantity}}</td>
                                            <td align="center">{{item.runCost | currency: 'USD': 'symbol':'1.3-3'}}</td>
                                            <td align="center">{{item.runCost*item.quantity | currency: 'USD':
                                                'symbol':'1.3-3'}}</td>
                                            <td align="center">{{item.runPrice | currency: 'USD': 'symbol':'1.3-3'}}
                                            </td>
                                            <td align="center">{{item.runPrice*item.quantity | currency: 'USD':
                                                'symbol':'1.3-3'}}</td>
                                        </tr>
                                        <tr>
                                            <td align="right"><span>{{item.blnStitchProcess ? 'Digitization(s)' :
                                                    'Setup(s)'}}</span></td>
                                            <td align="center"></td>
                                            <td align="center"></td>
                                            <td align="center">{{item.setupCost | currency: 'USD': 'symbol':'1.3-3'}}
                                            </td>
                                            <td align="center"></td>
                                            <td align="center">{{item.setupPrice | currency: 'USD': 'symbol':'1.3-3'}}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td align="right">
                                                <span *ngIf="item.blnColorProcess">{{item.blnColorProcess ? 'Total
                                                    Colors: ' + item.processQuantity : 'Stitch Count: ' +
                                                    item.processQuantity}}</span>
                                                <span *ngIf="item.imprintColors">/ Colors: {{item.imprintColors}}</span>
                                            </td>
                                            <td colspan="5"></td>
                                        </tr>
                                    </ng-container>

                                    <!--- ACCESSORIES --->
                                    <ng-container *ngIf="qryOrderLine.accessoriesData.length">
                                        <tr>
                                            <td colspan="6"><br /><i>ACCESSORIES</i></td>
                                        </tr>
                                        <ng-container *ngFor="let item of qryOrderLine.accessoriesData"
                                            query="local.qryAccessoriesReport">
                                            <tr>
                                                <td>{{item.packagingName}}</td>
                                                <td align="center">{{item.quantity}}</td>
                                                <td align="center">{{item.runCost | currency: 'USD': 'symbol':'1.3-3'}}
                                                </td>
                                                <td align="center">{{item.runCost * item.quantity | currency: 'USD':
                                                    'symbol':'1.3-3'}}</td>
                                                <td align="center">{{item.runPrice | currency: 'USD': 'symbol':'1.3-3'}}
                                                </td>
                                                <td align="center">{{item.runPrice * item.quantity | currency: 'USD':
                                                    'symbol':'1.3-3'}}</td>
                                            </tr>
                                            <ng-container *ngIf="item.setupCost || item.setupPrice">
                                                <tr>
                                                    <td align="right">Accessory Setup</td>
                                                    <td align="center"></td>
                                                    <td align="center"></td>
                                                    <td align="center">{{item.setupCost | currency: 'USD':
                                                        'symbol':'1.3-3'}}</td>
                                                    <td align="center"></td>
                                                    <td align="center">{{item.setupPrice | currency: 'USD':
                                                        'symbol':'1.3-3'}}</td>
                                                </tr>
                                            </ng-container>
                                        </ng-container>
                                    </ng-container>

                                    <!--- SHIPPING --->
                                    <tr height="10">
                                        <td colspan="6"></td>
                                    </tr>
                                    <tr>
                                        <td><i>SHIPPING &amp; HANDLING</i></td>
                                        <td align="center"></td>
                                        <td align="center"></td>
                                        <td align="center">{{qryOrderLine.shippingCost | currency: 'USD':
                                            'symbol':'1.3-3'}}</td>
                                        <td align="center"></td>
                                        <td align="center">{{qryOrderLine.shippingPrice | currency: 'USD':
                                            'symbol':'1.3-3'}}</td>
                                    </tr>
                                    <ng-container
                                        *ngIf="qryOrderLine.blnWarehouse && qryOrderLine.warehouseDeliveryOption">
                                        <tr>
                                            <td><span style="color:green; font-style:italic;">Fulfillment Shipping
                                                    Option: <b>{{qryOrderLine.warehouseDeliveryOption}}</b></span></td>
                                        </tr>
                                    </ng-container>

                                    <ng-container *ngIf="orderDetail.blnRoyaltyStore">
                                        <tr height="10">
                                            <td colspan="6"></td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <i>
                                                    {{orderDetail.royaltyName}}
                                                </i>
                                            </td>
                                            <td align="center"></td>
                                            <td align="center"></td>
                                            <td align="center"></td>
                                            <td align="center"></td>
                                            <td align="center">{{qryOrderLine.royaltyPrice | currency: 'USD':
                                                'symbol':'1.3-3'}}</td>
                                        </tr>
                                    </ng-container>

                                    <!--- SUB-TOTAL --->
                                    <tr height="10">
                                        <td colspan="6"></td>
                                    </tr>
                                    <tr>
                                        <td><br /><i>MERCHANDISE SUB-TOTAL</i></td>
                                        <td align="center"></td>
                                        <td align="center"></td>
                                        <td align="center"><b>{{qryOrderLine?.getOrderLineTotalsCost | currency: 'USD':
                                                'symbol':'1.3-3'}}</b>
                                        </td>
                                        <td align="center"></td>
                                        <td align="center"><b>{{qryOrderLine?.getOrderLineTotalsPrice | currency: 'USD':
                                                'symbol':'1.3-3'}}</b>
                                        </td>
                                    </tr>
                                </table>
                            </ng-container>
                            <!-- Totals -->
                            <hr class="my-2">
                            <table width="100%">
                                <tr height="1">
                                    <td width="50%"></td>
                                    <td width="10%"></td>
                                    <td width="10%"></td>
                                    <td width="10%"></td>
                                    <td width="10%"></td>
                                    <td width="10%"></td>
                                </tr>
                                <tr>
                                    <td>TOTAL <span>{{orderDetail.discount < 0 ? 'ADJUSTMENT' : 'DISCOUNT' }}</span>
                                    </td>
                                    <td align="center"></td>
                                    <td align="center"></td>
                                    <td align="center"></td>
                                    <td align="center"></td>
                                    <td align="center"><b>{{orderDetail.discount | currency: 'USD':
                                            'symbol':'1.3-3'}}</b></td>
                                </tr>
                                <ng-container *ngIf="orderDetail.cashbackDiscount">
                                    <tr>
                                        <td>CASH BACK DISCOUNT</td>
                                        <td align="center"></td>
                                        <td align="center"></td>
                                        <td align="center"></td>
                                        <td align="center"></td>
                                        <td align="center"><b>{{orderDetail.cashbackDiscount | currency: 'USD':
                                                'symbol':'1.3-3'}}</b></td>
                                    </tr>
                                </ng-container>
                                <tr>
                                    <td>TOTAL TAX</td>
                                    <td align="center"></td>
                                    <td align="center"></td>
                                    <td align="center"></td>
                                    <td align="center"></td>
                                    <td align="center"><b>{{orderDetail.orderTax | currency: 'USD':
                                            'symbol':'1.3-3'}}</b></td>
                                </tr>
                                <tr>
                                    <td>ADJUSTMENTS</td>
                                    <td align="center"></td>
                                    <td align="center"></td>
                                    <td align="center"></td>
                                    <td align="center"></td>
                                    <td align="center"></td>
                                </tr>
                                <ng-container *ngIf="orderDetail.qryOrderAdjustments">
                                    <tr *ngFor="let item of orderDetail.adjustmentsData">
                                        <td align="right">{{item.description}}</td>
                                        <td align="center"></td>
                                        <td align="center"></td>
                                        <td align="center"><b>{{item.cost | currency}}</b></td>
                                        <td align="center"></td>
                                        <td align="center"><b>{{item.price | currency}}</b></td>
                                    </tr>
                                </ng-container>
                            </table>
                            <hr class="my-2">
                            <table width="100%">
                                <tr height="1">
                                    <td width="50%"></td>
                                    <td width="10%"></td>
                                    <td width="10%"></td>
                                    <td width="10%"></td>
                                    <td width="10%"></td>
                                    <td width="10%"></td>
                                </tr>
                                <tr>
                                    <td><b>GRAND TOTAL</b></td>
                                    <td></td>
                                    <td></td>
                                    <td><b>{{orderDetail?.orderCost | currency: 'USD': 'symbol':'1.3-3'}}</b></td>
                                    <td></td>
                                    <td align="center"><b>{{orderDetail?.orderTotal | currency: 'USD':
                                            'symbol':'1.3-3'}}</b></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </fuse-card>
        </div>
    </div>
</div>