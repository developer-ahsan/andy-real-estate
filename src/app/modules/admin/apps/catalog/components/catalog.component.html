<div class="w-full">
    <div class="col-12 bg-card px-10 py-3">
        <div class="mt-2" #topScrollAnchor>
            <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight leading-7 sm:leading-10 truncate">
                Product Catalog
            </h2>
        </div>
        <div class="font-medium">
            <a class="whitespace-nowrap text-primary-500" *ngIf="!isLoading">Total Products {{total}}</a>
        </div>
    </div>
    <div class="row w-full p-2">
        <div class="col-12 col-md-4">
            <div class="row w-full p-5 m-0 rounded-2xl shadow bg-card">
                <div class="col-12">
                    <div class="text-2xl font-extrabold tracking-tight leading-none"> Filters
                    </div>
                </div>
                <div class="col-12 col-md-6 ">
                    <mat-form-field class="w-full">
                        <mat-label>Per Page:</mat-label>
                        <mat-select matInput [(ngModel)]="catalogFilter.perPage"
                            (selectionChange)="onPageChange($event)">
                            <mat-option [value]="25">25</mat-option>
                            <mat-option [value]="50">50</mat-option>
                            <mat-option [value]="100">100</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-12 col-md-6">
                    <mat-form-field class="w-full">
                        <mat-label>Sort by:</mat-label>
                        <mat-select matInput [(ngModel)]="sortBy" (selectionChange)="sortByFilter($event)">
                            <mat-option [value]="1">Product ID</mat-option>
                            <mat-option [value]="2">Price low to high</mat-option>
                            <mat-option [value]="3">Price high to low</mat-option>
                            <mat-option [value]="4">Name, A to Z</mat-option>
                            <mat-option [value]="5">Name, Z to A</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-12">
                    <mat-form-field class="w-full">
                        <mat-label>Keyword (PID, SPID, product name):</mat-label>
                        <input [(ngModel)]="keyWord" matInput matTooltip="Enter to search"
                            (keyup.enter)="searchByKeyword($event)">
                    </mat-form-field>
                </div>

                <div class="col-12 mb-3">
                    <mat-label>Vendor:</mat-label>
                    <ng-multiselect-dropdown [placeholder]="'Select Vendor'" [settings]="singleSelectDropdownSettings"
                        [data]="allSuppliers" [(ngModel)]="SelectedVendor" (onSelect)="onSelectedVendor($event)">
                    </ng-multiselect-dropdown>
                </div>

                <div class="col-12">
                    <mat-form-field class="w-full">
                        <mat-label>Vendor Relation:</mat-label>
                        <mat-select matInput [(ngModel)]="catalogFilter.vendor_relation"
                            (selectionChange)="vendorFilter($event)">
                            <mat-option [value]="0">Any Relation</mat-option>
                            <mat-option [value]="1">Normal</mat-option>
                            <mat-option [value]="2">Preffered</mat-option>
                            <mat-option [value]="3">Partner</mat-option>
                            <mat-option [value]="4">Preffered & Partner</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-12">
                    <mat-form-field class="w-full">
                        <mat-label>Min. quantity:</mat-label>
                        <input min="0" [(ngModel)]="minQuantity" matInput type="number"
                            (mousewheel)="$event.preventDefault()">
                    </mat-form-field>
                </div>
                <div class="col-12 col-md-6">
                    <mat-form-field class="w-full">
                        <mat-label>Min. price:</mat-label>
                        <input min="0" [(ngModel)]="minPrice" matInput type="number"
                            (mousewheel)="$event.preventDefault()">
                    </mat-form-field>
                </div>
                <div class="col-12 col-md-6">
                    <mat-form-field class="w-full">
                        <mat-label>Max. price:</mat-label>
                        <input min="0" [(ngModel)]="maxPrice" matInput type="number"
                            (mousewheel)="$event.preventDefault()">
                    </mat-form-field>
                </div>
                <div class="col-12 my-3">
                    <mat-label>Colors:</mat-label>
                    <ng-multiselect-dropdown [placeholder]="'Select Colors'" [settings]="dropdownSettings"
                        [data]="allColors" [(ngModel)]="selectedColor" (onSelect)="onSelectedColor($event)">
                    </ng-multiselect-dropdown>
                </div>
                <div class="col-12 my-3">
                    <mat-label>Decoration:</mat-label>
                    <ng-multiselect-dropdown [placeholder]="'Select Decoration'" [settings]="dropdownSettings"
                        [data]="allMethods" [(ngModel)]="selectedMethod" (onSelect)="onSelectedMethod($event)">
                    </ng-multiselect-dropdown>
                </div>
                <div class="col-12 my-3">
                    <mat-label>Size:</mat-label>
                    <ng-multiselect-dropdown [placeholder]="'Select Size'" [settings]="dropdownSettings"
                        [data]="allSizes" [(ngModel)]="selectedSize" (onSelect)="onSelectedSize($event)">
                    </ng-multiselect-dropdown>
                </div>
                <div class="col-12">
                    <mat-form-field class="w-full">
                        <mat-label>Active Products:</mat-label>
                        <mat-select matInput [(ngModel)]="catalogFilter.bln_active">
                            <mat-option [value]="1">Active Only</mat-option>
                            <mat-option [value]="2">Disabled Only</mat-option>
                            <mat-option [value]="''">Active & Disabled</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-12">
                    <button [color]="'primary'" class="w-full" mat-button mat-stroked-button [disabled]="isFilterLoader"
                        (click)="getCatalogs(1)">Filter</button>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-8 ">
            <div class="w-full p-6 rounded-2xl shadow bg-card" *ngIf="isLoading">
                <ngx-skeleton-loader count="15" appearance="line" animation="pulse">
                </ngx-skeleton-loader>
            </div>
            <div class="flex-auto p-6 sm:p-10 rounded-2xl shadow bg-card w-full" *ngIf="!isLoading">
                <div class="row">
                    <div class="col-12" *ngIf="isPageLoading || isFilterLoader">
                        <ngx-skeleton-loader count="15" appearance="line" animation="pulse">
                        </ngx-skeleton-loader>
                    </div>
                    <div class="col-12" *ngIf="!isPageLoading && !isFilterLoader">
                        <div class="flex flex-wrap mb-2 gap-2">
                            <button *ngIf="filterPayload.keyword !== ''" mat-button mat-stroked-button class="mr-1">
                                <span class="text-sm">Keyword: {{filterPayload.keyword}}</span>
                                <mat-icon svgIcon="heroicons_outline:x" class="icon-size-4 cursor-pointer"
                                    (click)="clearFilter('keyword')"></mat-icon>
                            </button>
                            <button *ngIf="filterPayload.companySearch !== ''" mat-button mat-stroked-button
                                class="mr-1">
                                <span class="text-sm">Vendor: {{SelectedVendor[0].companyName}}</span>
                                <mat-icon svgIcon="heroicons_outline:x" (click)="clearFilter('companySearch')"
                                    class="icon-size-4 cursor-pointer"></mat-icon>
                            </button>
                            <button *ngIf="filterPayload.vendorRelation !== 0" mat-button mat-stroked-button
                                class="mr-1">
                                <span class="text-sm">Vendor Relation: {{this.selectedVendorRelation}}</span>
                                <mat-icon svgIcon="heroicons_outline:x" (click)="clearFilter('vendorRelation')"
                                    class="icon-size-4 cursor-pointer"></mat-icon>
                            </button>
                            <button *ngIf="filterPayload.minPrice !== 0" mat-button mat-stroked-button class="mr-1">
                                <span class="text-sm">Min. Price: {{filterPayload.minPrice | currency}}</span>
                                <mat-icon svgIcon="heroicons_outline:x" (click)="clearFilter('minPrice')"
                                    class="icon-size-4 cursor-pointer"></mat-icon>
                            </button>
                            <button *ngIf="filterPayload.maxPrice !== 0" mat-button mat-stroked-button class="mr-1">
                                <span class="text-sm">Max. Price: {{filterPayload.maxPrice | currency}}</span>
                                <mat-icon svgIcon="heroicons_outline:x" (click)="clearFilter('maxPrice')"
                                    class="icon-size-4 cursor-pointer"></mat-icon>
                            </button>
                            <button *ngIf="filterPayload.colorSearch !== ''" mat-button mat-stroked-button class="mr-1">
                                <span class="text-sm">Colors: {{selectedColorString}}</span>
                                <mat-icon svgIcon="heroicons_outline:x" (click)="clearFilter('colorSearch')"
                                    class="icon-size-4 cursor-pointer"></mat-icon>
                            </button>
                            <button *ngIf="filterPayload.methodSearch !== ''" methodSearch mat-button mat-stroked-button
                                class="mr-1">
                                <span class="text-sm">Decoration: {{selectedDecorationString}}</span>
                                <mat-icon svgIcon="heroicons_outline:x" (click)="clearFilter('methodSearch')"
                                    class="icon-size-4 cursor-pointer"></mat-icon>
                            </button>
                            <button *ngIf="filterPayload.sizeSearch !== ''" mat-button mat-stroked-button class="mr-1">
                                <span class="text-sm">Sizes: {{this.selectedSizeString}}</span>
                                <mat-icon svgIcon="heroicons_outline:x" (click)="clearFilter('sizeSearch')"
                                    class="icon-size-4 cursor-pointer"></mat-icon>
                            </button>
                            <button *ngIf="filterPayload.minQuantity !== 0" mat-button mat-stroked-button class="mr-1">
                                <span class="text-sm">Min. Quantity: {{filterPayload.minQuantity}}</span>
                                <mat-icon svgIcon="heroicons_outline:x" (click)="clearFilter('minQuantity')"
                                    class="icon-size-4 cursor-pointer"></mat-icon>
                            </button>
                        </div>
                        <div class="bg-card shadow rounded-2xl p-5" *ngIf="dataSource.length == 0">
                            <fuse-alert [type]="'warning'" [appearance]="'outline'">
                                Please select filter choices to see product results.
                            </fuse-alert>
                        </div>
                    </div>
                    <div class="col-12" *ngIf="!isPageLoading && !isFilterLoader">
                        <pagination-controls *ngIf="dataSource.length > 0" previousLabel="Prev" nextLabel="Next"
                            (pageChange)="getNextCatalogData($event)">
                        </pagination-controls>
                        <div class="w-full" *ngIf="!isPageLoading">
                            <ng-container *ngFor="let item of dataSource |  paginate : {
                                itemsPerPage: itemsPerPage,
                                currentPage: page,
                                totalItems: total
                              };">
                                <div class="mb-12 p-8 rounded-2xl shadow bg-card">
                                    <div class="flex justify-between align-items-center">
                                        <div>
                                            <h2 class="my-0 font-semibold">{{item.productName}} -
                                                ({{item.pk_productID}})</h2>
                                            <div class="font-semibold text-md text-secondary">{{item.companyName}}</div>
                                        </div>
                                        <img class="w-20 h-20 m-0"
                                            src="https://assets.consolidus.com/globalAssets/Products/coming_soon.jpg">
                                    </div>
                                    <div class="col-12">
                                        <span
                                            class="inline-flex bg-default rounded py-1 text-secondary font-bold">Description</span>
                                        <div [innerHTML]="item.miniDesc" class="text-justify"></div>
                                    </div>
                                    <div class="row">
                                        <div *ngIf="item.Cost" class="col-12 col-md-6 m-0 overflow-x-auto">
                                            <span
                                                class="inline-flex bg-default rounded px-3 py-1 text-secondary font-bold">Cost</span>
                                            <table class="table table-striped ">
                                                <thead>
                                                    <tr>
                                                        <th *ngFor="let cost of item.Cost">{{cost.quantity}}</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td *ngFor="let cost of item.Cost">{{cost.cost | currency}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>


                                    </div>
                                    <hr class="mt-2">
                                    <span *ngIf="item.Imprint"
                                        class="inline-flex bg-default rounded px-3 py-1 text-secondary font-bold">Imprints</span>
                                    <div *ngFor="let imprint of item.Imprint" class="pt-1">
                                        <li>{{imprint.locationName+'/'+imprint.IM[0].methodName }}</li>
                                    </div>
                                </div>
                            </ng-container>
                        </div>
                        <div *ngIf="!isPageLoading && dataSource.length > 0">
                            <pagination-controls previousLabel="Prev" nextLabel="Next"
                                (pageChange)="getNextCatalogData($event)">
                            </pagination-controls>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>