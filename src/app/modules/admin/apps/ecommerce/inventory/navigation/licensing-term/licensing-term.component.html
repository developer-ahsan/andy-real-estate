<ngx-skeleton-loader count="8" appearance="line" animation="pulse" *ngIf="isLoading">
</ngx-skeleton-loader>
<div class="row my-3" *ngIf="!isLoading && selectedTerm">
    <div class="col-12">
        <fuse-card class="rounded-2xl shadow bg-card flex flex-col lg:flex-row w-full">
            <div class="p-6 sm:p-8 lg:p-10 w-full">
                <div class="text-2xl font-bold">
                    Selected Licensing Term
                </div>
                <div class="flex items-center mt-6">
                    <div class="font-medium text-secondary">{{selectedTerm.term}}</div>
                    <div class="flex-auto ml-2 border-b-2"></div>
                </div>
                <!-- Features -->
                <div class="grid grid-cols-2 lg:grid-cols-3 gap-y-4 mt-6">
                    <div class="flex items-center" *ngFor="let item of selectedSubCategItems">
                        <mat-radio-group name="opList">
                            <mat-radio-button style="min-width: -webkit-fill-available;" [checked]="item.Selected"
                                [value]="item" name="opList" (change)="selectedRadio($event)">
                                <span class="text-sm">{{item.name}}</span>
                            </mat-radio-button>
                        </mat-radio-group>
                    </div>
                </div>
                <div class="flex items-center justify-end w-full">
                    <div class="flex items-center my-2">
                        <div class="flex items-center mr-4" *ngIf="flashMessage && isSelectedUpdating">
                            <ng-container *ngIf="flashMessage === 'success'">
                                <mat-icon class="text-green-500" [svgIcon]="'heroicons_outline:check'">
                                </mat-icon>
                                <span class="ml-2">Licensing term Updated successfully</span>
                            </ng-container>
                            <ng-container *ngIf="flashMessage === 'error'">
                                <mat-icon class="text-red-500" [svgIcon]="'heroicons_outline:x'"></mat-icon>
                                <span class="ml-2">An error occurred, try again!</span>
                            </ng-container>
                        </div>
                        <button class="min-w-40" mat-stroked-button [matTooltip]="'Update Licensing Term'"
                            (click)="updateSelectedTerm()" [disabled]="selectedTermUpdateLoader">
                            <mat-progress-spinner *ngIf="selectedTermUpdateLoader" [diameter]="24"
                                [mode]="'indeterminate'">
                            </mat-progress-spinner>
                            <mat-icon *ngIf="!selectedTermUpdateLoader" [svgIcon]="'mat_outline:edit'"></mat-icon>
                            <span *ngIf="!selectedTermUpdateLoader" class="ml-1 mr-1">Update</span>
                        </button>
                    </div>
                </div>
            </div>
        </fuse-card>
    </div>
</div>
<div class="row my-3" *ngIf="!isLoading">
    <div class="col-12">
        <mat-card class="w-full p-2 h-full rounded-2xl shadow-lg">
            <div class="text-2xl font-bold p-6 sm:p-8 lg:p-6 w-full">
                Licensing Terms
            </div>
            <form [formGroup]="licensingForm">
                <div class="row" *ngIf="!radioButtonForm">
                    <div class="col-12 my-3">
                        <mat-form-field class="w-full" appearance="fill">
                            <mat-label>Select licensing company</mat-label>
                            <mat-select [formControlName]="'select'">
                                <mat-option *ngFor="let food of licensingCompanies" [value]="food">
                                    {{food.name}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="col-12 my-1 text-right">
                        <button class="min-w-40 w-40" mat-stroked-button (click)="continue()">
                            <span *ngIf="!radioButtonForm" class="mr-2">Continue</span>
                            <mat-icon *ngIf="!radioButtonForm" svgIcon="heroicons_outline:arrow-sm-right"></mat-icon>
                            <mat-progress-spinner *ngIf="radioButtonForm" [diameter]="24" [mode]="'indeterminate'">
                            </mat-progress-spinner>
                        </button>
                    </div>
                </div>
                <div class="row" *ngIf="radioButtonForm">
                    <div class="col-12 my-3">
                        <mat-accordion multi>
                            <div class="row">
                                <div class="col-lg-6 col-12" *ngFor="let license of licensingTerms;">
                                    <mat-expansion-panel class="my-2"
                                        [expanded]="license.pk_licensingTermID === selectedTermObject.pk_licensingTermID ? true : false"
                                        (opened)="expansionOpened(license)"
                                        [ngStyle]="license.Selected ? {'background-color':'rgba(15,23,42,0.36)'} : {'background-color': 'transparent'}">
                                        <mat-expansion-panel-header>
                                            <mat-panel-title
                                                [ngStyle]="license.Selected ? {'color':'white'} : {'color': 'black'}">
                                                {{license.term}}
                                            </mat-panel-title>
                                        </mat-expansion-panel-header>
                                        <ng-container *ngTemplateOutlet="myCard"></ng-container>
                                    </mat-expansion-panel>
                                </div>
                            </div>
                        </mat-accordion>
                    </div>
                    <div class="col-12">
                        <div class="flex items-center justify-end w-full">
                            <div class="flex items-center my-2">
                                <div class="flex items-center mr-4" *ngIf="flashMessage && !isSelectedUpdating">
                                    <ng-container *ngIf="flashMessage === 'success'">
                                        <mat-icon class="text-green-500" [svgIcon]="'heroicons_outline:check'">
                                        </mat-icon>
                                        <span class="ml-2">Licensing term Updated successfully</span>
                                    </ng-container>
                                    <ng-container *ngIf="flashMessage === 'error'">
                                        <mat-icon class="text-red-500" [svgIcon]="'heroicons_outline:x'"></mat-icon>
                                        <span class="ml-2">An error occurred, try again!</span>
                                    </ng-container>
                                </div>
                                <button class="min-w-40" mat-stroked-button [matTooltip]="'Update Licensing Term'"
                                    (click)="updateTerm()" [disabled]="termUpdateLoader">
                                    <mat-progress-spinner *ngIf="termUpdateLoader" [diameter]="24"
                                        [mode]="'indeterminate'">
                                    </mat-progress-spinner>
                                    <mat-icon *ngIf="!termUpdateLoader" [svgIcon]="'mat_outline:edit'"></mat-icon>
                                    <span *ngIf="!termUpdateLoader" class="ml-1 mr-1">Update</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </mat-card>
    </div>
</div>

<ng-template #myCard>
    <ngx-skeleton-loader count="4" appearance="line" animation="pulse" *ngIf="expansionLoader">
    </ngx-skeleton-loader>
    <div class="row" *ngIf="!expansionLoader">
        <div class="col-lg-6 col-12" *ngFor="let item of subCategoryItems">
            <mat-radio-group name="internalList">
                <mat-radio-button style="min-width: -webkit-fill-available;" [checked]="item.Selected" [value]="item"
                    name="internalList" (change)="selectedRadio($event)">
                    <span class="text-sm" style="white-space: normal;">{{item.name}}</span>
                </mat-radio-button>
            </mat-radio-group>
        </div>
    </div>
</ng-template>